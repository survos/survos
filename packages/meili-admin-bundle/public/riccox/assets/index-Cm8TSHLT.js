import{j as e,r as c,R as yt}from"./react-DLE0P_Nq.js";import{c as vt}from"./react-dom-Che-H8M2.js";/* empty css                     */import{_ as k,I as bt,a as It,b as _t,c as wt,d as kt,e as Dt,f as Nt,g as Ct,h as St,i as ze,j as Rt,k as Tt,l as Et,m as Lt,n as $t,o as Pt}from"./@tabler-Cs9ecyJm.js";import{i as Xe}from"./i18next-cOPaZ5Oq.js";import{B as zt}from"./i18next-browser-languagedetector-RoqpcJAD.js";import{r as Ot}from"./i18next-resources-to-backend-arTw0fVe.js";import{l as Ft,a as Mt,L as At,B as Se,T as qt,M as E,b as J,F as Z,c as V,P as Ze,S as xe,D as K,d as Kt,e as et,f as X,g as tt,h as Ke,I as Ue,i as Ut,R as Vt,j as _e}from"./@douyinfe-B-gXYr_B.js";import{i as Bt,u as b}from"./react-i18next-lY0zGp5V.js";import{E as Jt}from"./react-error-boundary-C4VCJz7Y.js";import{V as I}from"./lodash-7IVhutAX.js";import{M as Ht,a as Wt,B as Re,m as we,T as pe,A as G,u as je,C as Qt,b as he,N as Ve}from"./@mantine-CdmNQL9i.js";import{N as Yt,i as ke,t as ee,b as w,a as Gt,c as M,d as Xt,e as Zt,f as es}from"./@nextui-org-ClZNZrJG.js";import{T as ts,J as Q}from"./sonner-ujnykqh5.js";import{c as ss,O as Oe,T as ns,a as R,u as Fe,b as st,d as nt,e as is,f as O,L as U,k as os,g as as,h as te,Q as rs,i as ls,j as cs,R as ds,l as us}from"./@tanstack-L-Iso0cm.js";import{c as it}from"./clsx-D-TyrVPw.js";import{a as ms}from"./tailwind-merge-CsDznfHx.js";import{d as z,r as xs}from"./dayjs-BFE7UKt6.js";import{m as Te}from"./meilisearch-1KA7OaL4.js";import{c as ps,d as hs,p as fs}from"./zustand-CfOkDJBt.js";import{p as fe}from"./immer-3Uh6AxIC.js";import{D as ne}from"./vaul-BduuLnce.js";import{u as ot,C as P}from"./react-hook-form-CxOLOC0H.js";import{L as De,I as gs,T as at,S as js,B as se,a as ys}from"./@arco-design-CM7lE3ra.js";import{i as vs}from"./use-immer-BuNP1lWT.js";import{F as bs}from"./fuse.js-CU2r43ac.js";import{R as rt}from"./react-json-view-DWOhE2jV.js";import{E as Is}from"./echarts-for-react-5zOnsQJw.js";import{F as Me}from"./@monaco-editor-DVGnnzSC.js";import{u as _s}from"./ahooks-wYm_e60b.js";import"./@babel-4gviZBr6.js";import"./scheduler-CzFDRTuY.js";import"./date-fns-C-LZtYhP.js";import"./classnames-DDX9UkiM.js";import"./prop-types-CSW_MYNy.js";import"./@dnd-kit-CpUq43pE.js";import"./date-fns-tz-2Nz3Hr3W.js";import"./fast-copy-oTXv1nHL.js";import"./memoize-one-CcMeOnPo.js";import"./react-window-CG_AG5EW.js";import"./copy-text-to-clipboard-BVJXfyyl.js";import"./react-resizable-DrSWM7VI.js";import"./react-draggable-DHwASX4g.js";import"./bezier-easing-HI0P9lnN.js";import"./react-number-format-CgE9x4Yi.js";import"./@floating-ui-5a-OKKnD.js";import"./react-remove-scroll-rJ1HQWix.js";import"./tslib-DpYiEcgu.js";import"./react-remove-scroll-bar-CXDMel3C.js";import"./react-style-singleton-340SHUf5.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-CjXr77CS.js";import"./use-callback-ref-CV3T9hGv.js";import"./klona-fRfEZ5JV.js";import"./fast-deep-equal-BxCco598.js";import"./@react-aria-CH8kuybn.js";import"./@react-stately-Cz_UvoWO.js";import"./@swc-DS7M6wx8.js";import"./@internationalized-BB0Nk989.js";import"./framer-motion-C9dco-nu.js";import"./tailwind-variants-DDdm4Jbg.js";import"./tiny-invariant-CopsF_GD.js";import"./tiny-warning-Dirz_SfZ.js";import"./use-sync-external-store-B9AFrcTy.js";import"./goober-DovPBWGu.js";import"./@radix-ui-yUilMYjf.js";import"./aria-hidden-DQ5UC2Eg.js";import"./b-tween-BtQQsX34.js";import"./react-is-DcfIKM1A.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./react-transition-group-DAZH3qr6.js";import"./dom-helpers-D0mFdbeO.js";import"./echarts-CJ9wtMP5.js";import"./zrender-DaIPkqCf.js";import"./size-sensor-699oBplG.js";import"./state-local-BBNhjlcY.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const ws=(t,s,i)=>{const n=t[s];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((o,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})},ks=["en","zh"];var lt=(t=>(t.en="EN",t.zh="中文",t))(lt||{});const Be=["common","dashboard","task","key","upload","document","index","instance","header","sys"];Xe.use(Ot((t,s)=>ws(Object.assign({"../locales/en/common.json":()=>k(()=>import("./common-COUd-jLf.js"),[]),"../locales/en/dashboard.json":()=>k(()=>import("./dashboard-BQe1Yppc.js"),[]),"../locales/en/document.json":()=>k(()=>import("./document-IqAZJfRk.js"),[]),"../locales/en/footer.json":()=>k(()=>import("./footer-BIj5Y_wp.js"),[]),"../locales/en/header.json":()=>k(()=>import("./header-3hOI5g63.js"),[]),"../locales/en/index.json":()=>k(()=>import("./index-PkNcJL41.js"),[]),"../locales/en/instance.json":()=>k(()=>import("./instance-BtqJ2pS6.js"),[]),"../locales/en/key.json":()=>k(()=>import("./key-CmkBRqIZ.js"),[]),"../locales/en/sys.json":()=>k(()=>import("./sys-BdU-pjYe.js"),[]),"../locales/en/task.json":()=>k(()=>import("./task-BL-HVCPa.js"),[]),"../locales/en/upload.json":()=>k(()=>import("./upload-F3zO4OYV.js"),[]),"../locales/zh/common.json":()=>k(()=>import("./common-DXPfcykB.js"),[]),"../locales/zh/dashboard.json":()=>k(()=>import("./dashboard-UejX30fO.js"),[]),"../locales/zh/document.json":()=>k(()=>import("./document-B9nqrMFf.js"),[]),"../locales/zh/footer.json":()=>k(()=>import("./footer-Doln_TLQ.js"),[]),"../locales/zh/header.json":()=>k(()=>import("./header-BpiI20zM.js"),[]),"../locales/zh/index.json":()=>k(()=>import("./index-CgxAW3Ki.js"),[]),"../locales/zh/instance.json":()=>k(()=>import("./instance-BJxXJqU3.js"),[]),"../locales/zh/key.json":()=>k(()=>import("./key-BjBG3zan.js"),[]),"../locales/zh/sys.json":()=>k(()=>import("./sys-DoZMvjg8.js"),[]),"../locales/zh/task.json":()=>k(()=>import("./task-BXqCUVxI.js"),[]),"../locales/zh/upload.json":()=>k(()=>import("./upload-C65gM21-.js"),[])}),`../locales/${t}/${s}.json`,4))).use(zt).use(Bt).init({debug:!0,fallbackLng:ks[0],ns:Be,fallbackNS:Be[0],interpolation:{escapeValue:!1},detection:{order:["querystring","navigator","htmlTag"],lookupQuerystring:"lang",caches:["localStorage","cookie"],htmlTag:document.documentElement,convertDetectedLanguage:t=>/^(\w+)/.exec(t)[0]||"en"}});const Ds=t=>{switch(t){case"zh":return Mt;default:return Ft}},Ns=t=>{switch(t){case"zh":return"zh-CN";default:return"en"}},Cs=()=>{window.location.assign(window.location.origin)},ct=({error:t})=>{const{t:s}=b("sys");return e.jsx("div",{className:"full-page justify-center items-center w-fit",children:e.jsx("div",{className:"prompt danger outline w-1/2 max-w-7xl",children:e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("p",{className:"text-2xl",children:"🚨"}),e.jsx("p",{className:"text-2xl",children:s("warning")})]}),e.jsxs("div",{className:"",children:[e.jsx("p",{children:t.message}),e.jsx("p",{className:"link inline-block",onClick:Cs,children:s("reload")})]})]})})})},Ss=({children:t,onReset:s,FallbackComponent:i})=>e.jsx(Jt,{FallbackComponent:i||ct,onReset:s,children:t}),Rs=({children:t})=>e.jsx(Ss,{FallbackComponent:ct,children:t}),Ts={primary:{50:"#ffe2f1",100:"#ffb3d0",200:"#fd82af",300:"#fb518e",400:"#f8206e",500:"#df0755",600:"#ae0142",700:"#7e002f",800:"#4d001c",900:"#20000a",DEFAULT:"#f9377d"},secondary:{50:"#f2e4ff",100:"#d4b3ff",200:"#b881fd",300:"#9b4efc",400:"#7e1ffb",500:"#6608e2",600:"#4f04b0",700:"#38027e",800:"#22004d",900:"#0c001d",DEFAULT:"#21004b"}},Es={colors:Ts},Ls=({children:t})=>{const{i18n:s}=b();return e.jsx(At,{locale:Ds(s.resolvedLanguage),children:e.jsx(Ht,{theme:{colors:I.transform(I.pick(Es.colors,["primary","secondary"]),(i,n,o)=>{i||(i={}),i[o]=Object.values(n)}),primaryColor:"primary"},children:e.jsx(Wt,{modalProps:{centered:!0,lockScroll:!0,shadow:"xl",radius:"lg",padding:"xl",overlayProps:{opacity:.3}},children:e.jsx(Yt,{children:t})})})})},$s=({children:t})=>e.jsxs(e.Fragment,{children:[t,e.jsx(ts,{richColors:!0,closeButton:!0,theme:"light",position:"bottom-right"})]}),Ps=({children:t})=>e.jsx(Rs,{children:e.jsx(Ls,{children:e.jsx($s,{children:t})})}),ye=ss({component:()=>e.jsxs(e.Fragment,{children:[e.jsx(Oe,{}),e.jsx(ns,{})]}),wrapInSuspense:!0}),zs=()=>{const{t}=b("footer");return e.jsxs("div",{className:"text-nowrap",children:[t("powered_by")+" ",e.jsx("a",{className:"hover:underline",href:"https://riccox.com",target:"_blank",rel:"noreferrer",children:"Ricco Xie"})]})};function S(...t){return ms(it(t))}const dt=({className:t=""})=>{const{i18n:s}=b();return c.useEffect(()=>{z.locale(Ns(s.resolvedLanguage))},[s.resolvedLanguage]),e.jsx("select",{value:s.resolvedLanguage,className:S(t,"w-fit outline-none bg-transparent"),onChange:i=>{const n=i.target.value;s.changeLanguage(n)},children:I.entries(lt).map(([i,n])=>e.jsx("option",{value:i,children:n},n))})},Os="meilisearch-ui",Fs="module",Ms={dev:"vite",start:"vite",build:"vite build","build:safe":"tsc && vite build",preview:"vite preview",lint:"eslint"},As="https://github.com/riccox/meilisearch-ui",qs="https://github.com/riccox/meilisearch-ui#readme",Ks="Ricco Xie <ricco@riccox.com> (https://riccox.com)",Us={"@arco-design/web-react":"^2.64.0","@arco-themes/react-meilisearch":"^0.0.1","@douyinfe/semi-ui":"^2.67.0","@emotion/react":"^11.13.3","@hookform/resolvers":"^3.9.0","@mantine/core":"^7.13.2","@mantine/form":"^7.13.2","@mantine/hooks":"^7.13.2","@mantine/modals":"^7.13.2","@monaco-editor/react":"^4.6.0","@nextui-org/react":"^2.4.8","@radix-ui/react-slot":"^1.1.0","@semi-bot/semi-theme-meilisearch":"^0.0.2","@tabler/icons-react":"^3.19.0","@tanstack/react-query":"^5.59.8","@tanstack/react-query-devtools":"^5.59.8","@tanstack/react-router":"^1.64.0",ahooks:"^3.8.1","class-variance-authority":"^0.7.0",clsx:"^2.1.1",dayjs:"^1.11.13",echarts:"^5.5.1","echarts-for-react":"^3.0.2","framer-motion":"^11.11.7","fuse.js":"^7.0.0",i18next:"^23.15.2","i18next-browser-languagedetector":"^8.0.0","i18next-resources-to-backend":"^1.2.1",immer:"^10.1.1",lodash:"^4.17.21","lucide-react":"^0.451.0",meilisearch:"^0.44.1",qs:"^6.13.0",react:"^18.3.1","react-dom":"^18.3.1","react-error-boundary":"^4.0.13","react-hook-form":"^7.53.0","react-i18next":"^15.0.2","react-json-view":"^1.21.3",sonner:"^1.5.0","tailwind-merge":"^2.5.3","tailwind-variants":"^0.2.1","tailwindcss-animate":"^1.0.7","use-immer":"^0.10.0",vaul:"^1.0.0",zod:"^3.23.8",zustand:"5.0.0-rc.2"},Vs={"@eslint/compat":"^1.2.0","@eslint/js":"^9.12.0","@iconify-json/lucide":"^1.2.8","@tanstack/router-devtools":"^1.64.0","@tanstack/router-plugin":"^1.64.0","@types/lodash":"^4.17.10","@types/node":"^22.7.5","@types/qs":"^6.9.16","@types/react":"^18.3.11","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^8.8.1","@typescript-eslint/parser":"^8.8.1","@unocss/preset-icons":"^0.63.4","@vitejs/plugin-react-swc":"^3.7.1",autoprefixer:"^10.4.20",eslint:"9.12.0","eslint-config-react-app":"^7.0.1","eslint-plugin-react-hooks":"^4.6.2","eslint-plugin-react-refresh":"^0.4.12",globals:"^15.11.0",postcss:"^8.4.47",prettier:"^3.3.3",sass:"^1.79.4",tailwindcss:"^3.4.13",typescript:"5.6.3","typescript-eslint":"^8.8.1",unocss:"^0.63.4",vite:"^5.4.8","vite-tsconfig-paths":"^5.0.1"},Bs="0.8.0",Js="index.js",Hs="Apache-2.0",Ws={name:Os,private:!0,type:Fs,scripts:Ms,repository:As,homepage:qs,author:Ks,dependencies:Us,devDependencies:Vs,version:Bs,main:Js,license:Hs},Qs=Ws.version,Ys=()=>{const{t}=b();return e.jsxs("span",{className:"text-nowrap",children:[t("common:version"),": ",Qs,`[${"808024aa9f699e4541e89227b67d123fa4083242".slice(0,7)}]`]})},Gs=(t,s)=>Q(t,s),Xs=(t,s)=>Q.success(t,s),Zs=(t,s)=>Q.error(t,s),en=(t,s)=>Q.message(t,s),tn=(t,s)=>Q.promise(t,{loading:s.label,success:"Success",error:"Error",...s}),sn=t=>Q.dismiss(t),D=Object.assign(Gs,{success:Xs,error:Zs,info:en,remove:sn,loading:tn}),Ee="request-loader";let ie=[];const H=()=>{console.log("show loader");const t=setTimeout(()=>{const s=[...ie];s.splice(s.findIndex(i=>i===t),1),ie=s,D.loading(new Promise(()=>{setTimeout(()=>D.remove(Ee),5e3)}),{label:"Request loading...",success:"Request completed",error:"Request failed",id:Ee})},2e3);ie.push(t)},W=()=>{ie.forEach(t=>clearTimeout(t)),ie=[],D.remove(Ee)},ut="conn-test-loader",nn=()=>{D.loading(new Promise(()=>{}),{label:"Connection testing...",id:ut,duration:1/0})},Je=()=>{D.remove(ut)},Le=Xe.t,mt=async t=>{nn();const s=new Te.MeiliSearch({...t});let i;try{i=await s.getStats(),console.debug("[meilisearch connection test]",i)}catch(n){throw console.warn("[meilisearch connection test error]",n),D.error(Le("instance:connection_failed")),Je(),n}if(Je(),I.isEmpty(i)){const n=Le("instance:connection_failed");throw D.error(n),console.error(n,i),new Error("msg")}},on=t=>I.isEmpty(t)?{prompt:Le("instance:no_master_key_error")}:null,an=()=>(b("common"),e.jsx(e.Fragment,{})),ae=({className:t=""})=>e.jsxs("div",{className:S("gap-2 flex justify-center items-center w-full text-neutral-400 text-xs",t),children:[e.jsx(zs,{})," -",e.jsx(Ys,{})," -",e.jsx("a",{className:"hover:underline",href:"//github.com/riccox/meilisearch-ui",target:"_blank",rel:"noreferrer",children:"Github"}),"-",e.jsx(dt,{}),e.jsx(an,{})]}),re=({className:t,href:s})=>e.jsx("a",{className:S(t,"flex justify-center items-center"),href:s||"https://meilisearch.com",target:"_blank",rel:"noreferrer",children:e.jsx("img",{src:"/meili-logo.svg",className:"logo flex-1",alt:"Meili logo"})}),Ne={name:"default",host:"http://127.0.0.1:7700",apiKey:void 0},$=ps()(hs(fs((t,s)=>({instances:[],setWarningPageData:i=>t(fe(n=>{n.warningPageData=i})),addInstance:i=>t(fe(n=>{var o;n.instances.push({...i,updatedTime:new Date,id:(((o=I.maxBy(s().instances,"id"))==null?void 0:o.id)||0)+1})})),editInstance:(i,n)=>t(fe(o=>{const a=o.instances.findIndex(r=>r.id===i);a!==-1&&(o.instances[a]={...n,id:i,updatedTime:new Date})})),removeInstance:i=>t(fe(n=>{const o=n.instances.findIndex(a=>a.id===i);o!==-1&&n.instances.splice(o,1)}))}),{name:"meilisearch-ui-store",version:5})));function rn(){const{history:t}=Fe(),{t:s}=b("sys"),i=$(n=>n.warningPageData);return e.jsxs("div",{className:"full-page bg-night gap-y-10 justify-center items-center",children:[e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx(re,{}),e.jsx("h1",{className:"text-4xl font-bold text-primary-100",children:s("warning")})]}),(i==null?void 0:i.prompt)&&e.jsx("p",{className:"text-primary-100 font-semibold text-base whitespace-pre-line text-balance text-center",children:i.prompt}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Re,{color:"orange",onClick:()=>window.location.assign(window.location.origin),children:s("reload")}),e.jsx(Re,{variant:"gradient",color:"blue",onClick:()=>t.back(),children:s("back")})]}),e.jsx(ae,{})]})}const ln=R("/warning")({component:rn}),cn=t=>{const s=st(),i=$(o=>o.setWarningPageData);return c.useCallback((o,a)=>{console.debug("useNavigatePreCheck",o);const r=t(o,a);r!==null?(i(r),s({to:"/warning"})):s(o??{})},[s,t,i])},T=()=>{const{t}=b("instance"),{insID:s}=nt({strict:!1}),i=$(n=>n.instances.find(o=>o.id===parseInt(s||"1")));return $(n=>n.setWarningPageData),i&&I.isEmpty(i)&&(D.error(`${t("not_found")} 🤥`),console.debug("useCurrentInstance","Instance lost"),window.location.assign("/")),i},$e=({className:t="",children:s,type:i="create",ins:n})=>{const[o,a]=c.useState(!1),{t:r}=b("instance"),l=T(),[m]=c.useState(i),[p,j]=c.useState(!1),[g]=c.useState(n),u=$(y=>y.addInstance),d=$(y=>y.editInstance),h=$(y=>y.instances),x=ot({defaultValues:{...Ne,host:(l==null?void 0:l.host)??Ne.host,apiKey:(l==null?void 0:l.apiKey)??Ne.apiKey}}),f=c.useCallback(async y=>{j(!0);const v={...y,host:`${/^(https?:\/\/)/.test(y.host)?"":"http://"}${y.host}`};v.apiKey=I.isEmpty(v.apiKey)?void 0:v.apiKey,mt({...v}).finally(()=>{j(!1)}).then(()=>{switch(m){case"create":u({...v});break;case"edit":d(g.id,{...v});break}a(!1),x.reset()})},[m,x,u,d,g]);return e.jsxs(ne.Root,{open:o,onOpenChange:y=>{x.reset(n),a(y)},children:[e.jsx(ne.Trigger,{"data-state":o?"open":"closed",children:s}),e.jsxs(ne.Portal,{children:[e.jsx(ne.Overlay,{className:"fixed inset-0 bg-black/40"}),e.jsx(ne.Content,{className:S(t,"bg-zinc-100 rounded-t-6 mt-24 fixed bottom-0 left-0 right-0 z-10"),children:e.jsxs("form",{className:"flex flex-col gap-y-6 w-full p-4 bg-white flex-1 rounded-t-6",onSubmit:x.handleSubmit(f),children:[e.jsx("div",{"bg-zinc-4":!0,"rounded-2xl":!0,"w-15":!0,"h-2":!0,"self-center":!0}),e.jsx("p",{className:"text-center font-semibold text-lg",children:r(`form.title.${m}`)}),e.jsx(P,{control:x.control,name:"name",rules:{validate:y=>{let v=[];switch(m){case"create":v=h.map(_=>_.name);break;case"edit":v=h.map(_=>_.name).filter(_=>_!==g.name);break}return v.includes(y)?(x.setError("name",{message:"Name should be different from others"}),!1):!0}},render:({field:y,fieldState:v})=>{var _,N;return e.jsx(ke,{label:r("form.name.label"),placeholder:r("form.name.placeholder"),isInvalid:!!((_=v.error)!=null&&_.message),errorMessage:(N=v.error)==null?void 0:N.message,...y})}}),e.jsx(P,{control:x.control,name:"host",rules:{validate:y=>/^(https?:\/\/)?([a-zA-Z0-9-]+((\.[a-zA-Z0-9-]+)+)?(:\d+)?)(\/[^\s]*)?$/.test(y)?!0:(x.setError("host",{message:"Host not valid"}),!1)},render:({field:y,fieldState:v})=>{var _,N;return e.jsx(e.Fragment,{children:e.jsx(ee,{placement:"bottom-start",content:r("form.host.tip"),children:e.jsx(ke,{placeholder:"http://127.0.0.1:7700",label:r("form.host.label"),isInvalid:!!((_=v.error)!=null&&_.message),errorMessage:(N=v.error)==null?void 0:N.message,...y})})})}}),e.jsx(P,{control:x.control,name:"apiKey",render:({field:y,fieldState:v})=>{var _,N;return e.jsx(ee,{placement:"bottom-start",content:r("form.api_key.tip"),children:e.jsx(ke,{type:"password",placeholder:"masterKey",label:r("form.api_key.label"),isInvalid:!!((_=v.error)!=null&&_.message),errorMessage:(N=v.error)==null?void 0:N.message,...y})})}}),e.jsx(w,{type:"submit",variant:"solid",size:"sm",color:"primary",disabled:p,children:r("confirm")}),e.jsx(ae,{})]})})]})]})};z.extend(xs);const dn=t=>`Task submit ${t.status}, task uid ${t.taskUid} 🚀`,xt={succeeded:D.success,enqueued:D.info,failed:D.error,processing:D.info,canceled:D.info},F=t=>{xt[t.status](dn(t))},Pe=t=>{xt.failed(`Task Fail: ${t.toString()}`)},B=(t,{defaultText:s="-",format:i="YYYY-MM-DD HH:mm:ss.SSS"}={})=>!t&&s?s:z(t).format(i),un=t=>z(t).fromNow(),mn=t=>JSON.stringify(t,void 0,2);function He(t){return z(t).isValid()?/^\d+$/g.test(t)&&t.length<13?z.unix(parseInt(t)).toDate():z(t).toDate():!1}function We(t){try{const s=new URL(t);return(s.protocol==="http:"||s.protocol==="https:")&&/\.(jpg|jpeg|png|gif|webp)$/.test(s.pathname)}catch{return!1}}const oe=({className:t="",date:s})=>{const[i,n]=c.useState(!1);return e.jsx("div",{className:S("w-fit h-fit",t),onMouseEnter:()=>{n(!0)},onMouseLeave:()=>{n(!1)},children:s?i?B(s):un(s):"-"})},Qe="col-span-1 h-28 rounded-lg";function xn(){const{t}=b("dashboard"),s=cn((l,m)=>{var p;return console.debug("dashboard","navigate",l.to,m==null?void 0:m.currentInstance),typeof l.to=="string"&&/\/keys$/.test(l.to)?on((p=m==null?void 0:m.currentInstance)==null?void 0:p.apiKey):null}),i=$(l=>l.removeInstance),n=$(l=>l.instances),o=c.useCallback((l,m)=>{mt({...l}).then(()=>{m&&s({to:m},{currentInstance:l})})},[s]),a=c.useCallback(l=>{const m="removeInsModal";we.open({modalId:m,title:t("instance.remove.title"),centered:!0,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("p",{children:[t("instance.remove.tip")," (",l.name,")?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Se,{block:!0,theme:"solid",type:"danger",onClick:()=>{i(l.id),we.close(m)},children:t("confirm")}),e.jsx(Se,{block:!0,theme:"solid",type:"secondary",onClick:()=>{we.close(m)},children:t("cancel")})]})]})})},[i,t]),r=c.useMemo(()=>n.map((l,m)=>e.jsxs("div",{className:`bg-white flex flex-col justify-between py-4 px-6 group
      hover:ring-primary-100 hover:ring-2 ${Qe}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-2xl font-bold group-hover:underline cursor-pointer",onClick:()=>o(l,`/ins/${l.id}`),children:l.name}),e.jsxs("p",{className:"text-2xl font-bold cursor-pointer text-bw-800/50",onClick:()=>o(l,`/ins/${l.id}`),children:["#",l.id]})]}),e.jsxs("div",{className:"flex gap-x-3",children:[e.jsx($e,{ins:l,type:"edit",children:e.jsx(pe,{position:"left",label:t("edit"),children:e.jsx(G,{variant:"light",color:"yellow",children:e.jsx(bt,{size:24})})})}),e.jsx(G,{variant:"light",onClick:()=>a(l),children:e.jsx(It,{size:24})})]})]}),e.jsxs("div",{className:"w-full flex justify-end items-center gap-x-3",children:[e.jsxs("p",{className:"mr-auto text-neutral-500 text-sm inline-flex gap-1",children:[t("instance.updated_at")," ",e.jsx(oe,{date:l.updatedTime})]}),e.jsx(pe,{position:"bottom",label:t("indexes"),children:e.jsx(G,{variant:"light",color:"violet",onClick:()=>o(l,`/ins/${l.id}`),children:e.jsx(_t,{size:24})})}),e.jsx(pe,{position:"bottom",label:t("tasks"),children:e.jsx(G,{variant:"light",color:"blue",onClick:()=>o(l,`/ins/${l.id}/tasks`),children:e.jsx(wt,{size:24})})}),e.jsx(pe,{position:"bottom",label:t("keys"),children:e.jsx(G,{variant:"light",color:"grape",onClick:()=>o(l,`/ins/${l.id}/keys`),children:e.jsx(kt,{size:24})})})]})]},m)),[n,o,a,t]);return e.jsxs("div",{className:"bg-mount full-page justify-center items-center gap-y-6",children:[e.jsxs("div",{className:"w-1/2 2xl:w-1/4 h-2/3 flex flex-col justify-center items-center gap-y-10",children:[e.jsx(re,{className:"size-20"}),e.jsx("p",{className:"text-primary-100 font-bold xl:text-3xl text-xl w-screen text-center",children:t("slogan")}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-3 w-full p-1  overflow-y-scroll",children:[r,e.jsx($e,{type:"create",children:e.jsx("div",{className:`${Qe}
              flex justify-center items-center 
              hover:cursor-pointer hover:opacity-80 hover:border-neutral-200 hover:border-2 
              bg-neutral-500 bg-opacity-30 border border-neutral-500 border-dashed`,children:e.jsx(Dt,{color:"white",opacity:.5,size:48})})})]})]}),e.jsx(ae,{className:"!text-white"})]})}const pn=R("/")({component:xn,beforeLoad:async()=>{}}),hn=()=>{const t=is(),{t:s}=b(),i=t({to:"/ins/$insID",fuzzy:!0}),n=t({to:"/ins/$insID/keys",fuzzy:!0}),o=t({to:"/ins/$insID/tasks",fuzzy:!0}),a=t({to:"/ins/$insID/index/$indexUID",fuzzy:!0}),r=t({to:"/ins/$insID/index/$indexUID/documents",fuzzy:!0}),l=t({to:"/ins/$insID/index/$indexUID/documents/upload",fuzzy:!0}),m=t({to:"/ins/$insID/index/$indexUID/setting",fuzzy:!0}),p=$(j=>j.instances.find(g=>g.id===parseInt(i.insID)));return e.jsxs(Gt,{color:"primary",variant:"light",children:[e.jsx(M,{href:"/",children:"🏠"}),i&&e.jsx(M,{href:`/ins/${i.insID}`,children:`#${i.insID} ${s("common:instance")} ${p==null?void 0:p.name}`}),n&&e.jsx(M,{href:`/ins/${i.insID}/keys`,children:`${s("common:keys")}`}),o&&e.jsx(M,{href:`/ins/${i.insID}/tasks`,children:`${s("common:tasks")}`}),a&&e.jsx(M,{href:`/ins/${i.insID}/index/${a.indexUID}`,children:`${s("common:indexes")}: ${a.indexUID}`}),r&&e.jsx(M,{href:`/ins/${i.insID}/index/${a.indexUID}/documents`,children:`${s("documents")}`}),l&&e.jsx(M,{href:`/ins/${i.insID}/index/${a.indexUID}/documents/upload`,children:`${s("upload:title")}`}),m&&e.jsx(M,{href:`/ins/${i.insID}/index/${a.indexUID}/setting`,children:`${s("settings")}`})]})},fn=()=>{const{t}=b("header");return e.jsxs("header",{className:"px-4 py-2 bg-white border-b border-neutral-600/20 overflow-hidden flex items-center gap-4 flex-shrink-0 flex-grow-0 basis-auto",children:[e.jsx(re,{className:"size-8"}),e.jsx(hn,{}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx(De,{href:"https://docs.meilisearch.com",target:"_blank",className:"!inline-flex items-center !no-underline",icon:e.jsx(Nt,{size:"1.5em"}),children:t("meilisearch_docs")}),e.jsx(De,{href:"https://github.com/riccox/meilisearch-ui/issues",target:"_blank",className:"!inline-flex items-center !no-underline",icon:e.jsx(Ct,{size:"1.5em"}),children:t("issues")}),e.jsx(De,{href:"https://github.com/riccox/meilisearch-ui",target:"_blank",className:"!inline-flex items-center !no-underline",icon:e.jsx(St,{size:"1.5em"}),children:t("open_source")}),e.jsx(dt,{className:"text-small font-semibold"})]})]})},gn="_loader_ekbha_2",jn="_l13_ekbha_1",yn={loader:gn,l13:jn},ve=({className:t})=>e.jsxs("div",{className:S(yn.loader,t,""),children:[e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{})]}),A=({className:t,loaderCls:s})=>e.jsx("div",{className:S(t,"w-full h-full flex-1 flex justify-center items-center"),children:e.jsx(ve,{className:s})});function vn(){return e.jsxs("div",{className:"full-page",children:[e.jsx(fn,{}),e.jsx(Oe,{})]})}const bn=R("/ins/$insID/_layout")({component:vn,pendingComponent:A}),C=()=>{const{t}=b("instance"),s=T(),[i,n]=c.useState(new Te.MeiliSearch({...s})),o=$(r=>r.setWarningPageData),a=c.useCallback(async()=>{if(I.isEmpty(s==null?void 0:s.host)){D.error(t("connection_failed")),console.debug("useMeilisearchClient","connection config lost"),window.location.assign("/");return}const r=new Te.MeiliSearch({...s});try{await r.getStats(),n(r)}catch(l){console.warn("useMeilisearchClient","test conn error",l),D.error(t("connection_failed")),window.location.assign("/")}},[s,o,t]);return c.useEffect(()=>{console.debug("useMeilisearchClient","rebuilt meili client"),a().then()},[a,s]),i},Ae=t=>{const s=T(),i=s==null?void 0:s.host,[n,o]=c.useState(),a=O({queryKey:["stats",i],queryFn:async()=>({...await t.getStats(),version:await t.getVersion()})});return c.useEffect(()=>{a.isSuccess&&o(a.data),a.isError&&console.warn("get meilisearch stats error",a.error)},[a.data,a.error,a.isError,a.isSuccess]),n},be=({className:t="",children:s})=>{const{t:i}=b();return e.jsx(qt.Paragraph,{className:t,copyable:{onCopy:()=>Q.success(i("common:copied")),icon:e.jsx(ze,{size:"0.95em",className:" text-current"}),copyTip:i("common:copy"),successTip:"✅"},children:s})},In=t=>{const s=T(),[i,n]=c.useState(!0),o=O({queryKey:["health",s==null?void 0:s.host],queryFn:async()=>(await t.health()).status==="available",refetchInterval:3e4});return c.useEffect(()=>{o.isSuccess&&n(o.data)},[o.data,o.isSuccess]),i},_n=({afterMutation:t})=>{const{t:s}=b("instance"),i=C(),n=je({initialValues:{uid:"",primaryKey:void 0},validate:{uid:p=>/[\da-zA-Z-_]+/.test(p)?null:s("create_index.form.uid.validation_error")}}),[o,a]=c.useState(!1),r=()=>{a(!0)},l=()=>{a(!1),n.reset()},m=c.useCallback(async p=>{let j;try{j=await i.createIndex(p.uid,{primaryKey:p.primaryKey}),console.info(j),I.isEmpty(j)||(F(j),t())}catch(g){console.warn(g),D.error(s("toast.fail",{msg:g}))}},[t,i,n,s]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",color:"primary",onClick:()=>{r()},children:s("common:create")}),e.jsx(E,{centered:!0,footerFill:!0,visible:o,title:s("create_index.label"),okText:s("create_index.label"),cancelText:s("common:cancel"),afterClose:()=>{l()},onOk:async()=>{await m(n.values),l()},onCancel:l,children:e.jsxs("form",{className:"pt-3 space-y-3",children:[e.jsx(J,{position:"bottomLeft",content:s("create_index.form.uid.tip"),children:e.jsx(Z,{autoFocus:!0,addonBefore:"UID",placeholder:s("create_index.form.uid.placeholder"),required:!0,...n.getInputProps("uid")})}),e.jsx(J,{position:"bottomLeft",content:s("create_index.form.primaryKey.tip"),children:e.jsx(Z,{addonBefore:s("create_index.form.primaryKey.label"),placeholder:s("create_index.form.primaryKey.placeholder"),...n.getInputProps("primaryKey")})})]})})]})},Ye=new bs([],{keys:["uid","primaryKey"],includeMatches:!1,includeScore:!0,shouldSort:!0}),wn=({className:t="",client:s})=>{var u,d;const{t:i}=b("index"),n=T(),o=n==null?void 0:n.host,a=Ae(s),[r,l]=vs({offset:0,limit:24,query:""}),m=O({queryKey:["indexList",o,r],queryFn:async()=>{const h=await s.getIndexes(I.pick(r,["offset","limit"]));return Ye.setCollection(h.results||[]),h},placeholderData:os}),p=c.useMemo(()=>{var h;return r.query&&r.query.trim().length>0?Ye.search(r.query).map(x=>x.item)||[]:((h=m.data)==null?void 0:h.results)||[]},[(u=m.data)==null?void 0:u.results,r.query]),j=c.useMemo(()=>p.map(h=>{const x=h.uid,f=a==null?void 0:a.indexes[h.uid];return{uid:x,numberOfDocuments:(f==null?void 0:f.numberOfDocuments)||0,href:`/ins/${n.id}/index/${x}`,isIndexing:f==null?void 0:f.isIndexing}}),[n.id,p,a==null?void 0:a.indexes]),g=c.useMemo(()=>{var h;return{currentPage:r.offset/r.limit+1,totalPage:I.ceil((((h=m.data)==null?void 0:h.total)||0)/r.limit)}},[(d=m.data)==null?void 0:d.total,r.limit,r.offset]);return c.useMemo(()=>{var h;return e.jsxs("div",{className:S("flex flex-col gap-y-2 flex-1",t),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-2xl font-bold text-nowrap",children:i("common:indexes")}),e.jsx(J,{content:i("search.tip"),children:e.jsx("div",{className:"ml-auto !w-60",children:e.jsx(gs.Search,{placeholder:i("common:search"),defaultValue:"",onChange:x=>l(f=>{f.query=x})})})}),e.jsx(_n,{afterMutation:()=>m.refetch()})]}),e.jsx("div",{className:"grid grid-cols-6 gap-5 place-content-start place-items-start py-3",children:j==null?void 0:j.map(x=>e.jsxs(Xt,{as:U,to:x.href,fullWidth:!0,shadow:"sm",className:"col-span-3 laptop:col-span-2 hover:no-underline h-fit hover:outline-primary-400/80 outline outline-2 outline-transparent",children:[e.jsx(Zt,{children:e.jsx("div",{className:"text-xl px-1",children:x.uid})}),e.jsx(es,{className:"space-y-2",children:e.jsxs("div",{className:"flex",children:[e.jsxs(V,{size:"small",color:"cyan",className:"mr-auto",children:[i("count"),": ",x.numberOfDocuments??0]}),x.isIndexing&&e.jsx(J,{content:i("indexing_tip"),children:e.jsxs(V,{color:"amber",size:"small",className:"flex flex-nowrap",children:[e.jsx(Rt,{size:"1em"}),e.jsxs("div",{children:[i("indexing"),"..."]})]})})]})})]},x.uid))}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ze,{pageSize:r.limit,total:(h=m.data)==null?void 0:h.total,currentPage:g.currentPage,onPageChange:x=>{l(f=>{f.offset=(x-1)*r.limit}),m.refetch()}})})]})},[t,j,g.currentPage,m,r.limit,i,l])},pt=({className:t="",children:s})=>e.jsxs("div",{className:S(t,"w-fit text-3xl font-bold relative z-10 text-ellipsis"),children:[s,e.jsx("div",{className:"-z-10 absolute w-full h-[0.8rem] bg-primary-400/75 -bottom-[2px] rounded-lg"})]}),kn=()=>{const{t}=b("instance"),s=T(),i=C(),n=c.useCallback(()=>{E.confirm({title:t("instance:dump.dialog.title"),centered:!0,content:e.jsx("p",{children:t("instance:dump.dialog.tip",{name:s.name})}),onOk:async()=>{F(await i.createDump())},okText:t("confirm"),cancelText:t("cancel")})},[i,s.name,t]);return e.jsxs(w,{onClick:n,color:"default",variant:"light",size:"sm",children:[e.jsx("div",{className:"i-lucide:archive-restore w-1em h-1em"}),"Dump"]})};function Dn(){const{t}=b("instance"),s=T(),i=C(),n=Ae(i),o=In(i),a=c.useMemo(()=>[{key:t("host"),value:e.jsx(be,{children:s.host})},{key:t("common:updated_at"),value:e.jsx(oe,{date:s.updatedTime})},{key:t("db_size"),value:e.jsx(xe,{placeholder:e.jsx(xe.Title,{}),active:!0,loading:!(n!=null&&n.databaseSize),children:`${I.ceil(((n==null?void 0:n.databaseSize)??0)/1048576,2)} MB`})},{key:t("status.label"),value:o?e.jsx(V,{color:"green",children:t("status.available")}):e.jsx(V,{color:"amber",children:t("unknown")})},{key:t("version.label"),value:e.jsx(xe,{placeholder:e.jsx(xe.Title,{}),active:!0,loading:!(n!=null&&n.version),children:e.jsx(V,{children:n==null?void 0:n.version.pkgVersion})})}],[s.host,s.updatedTime,o,n==null?void 0:n.databaseSize,n==null?void 0:n.version,t]);return e.jsxs("div",{className:"flex-1 grid grid-cols-4 overflow-scroll",children:[e.jsxs("main",{className:"p-4 laptop:col-start-2 laptop:col-end-4 col-start-1 col-end-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 items-baseline",children:[e.jsx(pt,{children:`#${s.id} ${s.name}`}),e.jsx($e,{ins:s,type:"edit",children:e.jsx(at,{content:t("edit"),position:"right",mini:!0,children:e.jsx("div",{className:"i-lucide:edit w-1em h-1em cursor-pointer hover:scale-90 transition"})})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(K,{className:"flex-1",align:"left",data:a}),e.jsxs("div",{className:"flex flex-col gap-3 items-start",children:[e.jsx(U,{to:"keys",from:"/ins/$insID",children:e.jsxs(w,{variant:"light",size:"sm",children:[e.jsx("div",{className:"i-lucide:key w-1em h-1em"})," ",t("keys")]})}),e.jsx(U,{to:"tasks",from:"/ins/$insID",children:e.jsxs(w,{variant:"light",size:"sm",children:[e.jsx("div",{className:"i-lucide:workflow w-1em h-1em"}),t("tasks")]})}),e.jsx(kn,{})]})]}),e.jsx(wn,{client:i})]}),e.jsx(ae,{className:"col-span-full mt-auto mb-3"})]})}const Nn=R("/ins/$insID/_layout/")({component:Dn,pendingComponent:A}),Cn=()=>{var m;const{t}=b("task"),s=C(),i=T(),n=i==null?void 0:i.host,[o,a]=c.useReducer((p,j)=>({...p,...j}),{limit:20,from:0}),r=O({queryKey:["tasks",n,o],queryFn:async()=>(H(),console.debug(s.config,o),await s.getTasks({...I.omitBy(o,I.isEmpty)}))});c.useEffect(()=>{r.isError&&console.warn("get meilisearch tasks error",r.error),r.isFetching||W()},[r.error,r.isError,r.isFetching]);const l=[{title:"UID",dataIndex:"uid",width:100},{title:t("indexes"),dataIndex:"indexUid",width:120,render:p=>p||"-"},{title:t("common:type"),dataIndex:"type",width:120,render:p=>t(`type.${p}`)},{title:t("common:status"),dataIndex:"status",width:120,render:p=>t(`status.${p}`)},{title:t("duration"),dataIndex:"duration",width:120},{title:t("enqueued_at"),dataIndex:"enqueuedAt",width:220,render:(p,j)=>B(j.enqueuedAt)},{title:t("started_at"),dataIndex:"startedAt",width:220,render:(p,j)=>B(j.startedAt)},{title:t("finished_at"),dataIndex:"finishedAt",width:220,render:(p,j)=>B(j.finishedAt)},{title:t("actions"),dataIndex:"operate",render:(p,j)=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(w,{size:"sm",onClick:()=>{E.info({title:t("common:detail"),centered:!0,footer:null,content:e.jsx("div",{className:"flex justify-center items-center p-4 pb-6",children:e.jsx(rt,{name:!1,displayDataTypes:!1,displayObjectSize:!1,enableClipboard:!1,src:j,collapsed:3,collapseStringsAfterLength:50})})})},variant:"flat",children:t("common:detail")})})}];return e.jsx("div",{className:"flex-1 overflow-scroll max-h-fit",children:e.jsxs("main",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx(Kt,{className:"flex-1",placeholder:t("filter.index.placeholder"),onChange:p=>{a({indexUids:p})}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-nowrap",children:t("filter.enqueuedAt.label")}),e.jsx(et,{type:"dateTimeRange",onChange:p=>{p&&a({beforeEnqueuedAt:p[1],afterEnqueuedAt:p[1]})}})]}),e.jsx(X,{placeholder:t("filter.type.placeholder"),optionList:I.entries(t("type",{returnObjects:!0})).map(([p,j])=>({value:p,label:j})),multiple:!0,onChange:p=>{a({types:p||void 0})}}),e.jsx(X,{placeholder:t("filter.status.placeholder"),optionList:I.entries(t("status",{returnObjects:!0})).map(([p,j])=>({value:p,label:j})),multiple:!0,onChange:p=>{a({statuses:p||void 0})}})]}),e.jsx(tt,{columns:l,dataSource:(m=r.data)==null?void 0:m.results,pagination:!1,empty:t("empty")})]})})},Sn=R("/ins/$insID/_layout/tasks")({component:Cn,pendingComponent:A}),Rn=(t,s)=>{const i=T(),n=i==null?void 0:i.host,[o,a]=c.useState([]),r=O({queryKey:["indexes",n],queryFn:async()=>(await t.getIndexes(s)).results});return c.useEffect(()=>{r.isSuccess&&a(r.data)},[r.data,r.isSuccess]),[o,r]},Tn=({className:t="",type:s="create",data:i,afterSubmit:n})=>{const{t:o}=b("key"),a=C(),[r]=c.useState(s),[l,m]=c.useState(!1),[p]=c.useState(i),[j]=Rn(a,{limit:1e4}),g=ot({defaultValues:s==="edit"?p:{}}),u=c.useCallback(async d=>{switch(m(!0),r){case"create":await a.createKey({...d,indexes:I.isEmpty(d.indexes)?["*"]:d.indexes,actions:I.isEmpty(d.actions)?["*"]:d.actions,expiresAt:I.isEmpty(d.expiresAt)?null:B(d.expiresAt,{format:"YYYY-MM-DD HH:mm:ss+00:00"})});break;case"edit":await a.updateKey(p.uid,{...d});break}m(!1),n()},[r,n,a,p]);return e.jsxs("form",{className:S(t,"flex flex-col gap-y-6 w-full p-4 bg-white flex-1 rounded-t-6"),onSubmit:g.handleSubmit(u),children:[e.jsx("p",{className:"text-center font-semibold text-lg",children:o(`form.title.${r}`)}),e.jsx(P,{control:g.control,name:"uid",rules:{required:!1},render:({field:d})=>e.jsxs("label",{children:["UID",e.jsx(Z,{disabled:r==="edit",placeholder:o("form.uid.placeholder"),value:d.value,onChange:h=>d.onChange(h)})]})}),e.jsx(P,{control:g.control,name:"name",rules:{required:!0},render:({field:d})=>e.jsxs("label",{children:[o("name"),e.jsx(Z,{placeholder:o("form.name.placeholder"),value:d.value,onChange:h=>d.onChange(h)})]})}),e.jsx(P,{control:g.control,name:"description",rules:{required:!0},render:({field:d})=>e.jsxs("label",{children:[o("description"),e.jsx(Z,{placeholder:o("form.description.placeholder"),value:d.value,onChange:h=>d.onChange(h)})]})}),e.jsx(ee,{placement:"bottom-start",content:o("form.indexes.tip"),children:e.jsx(P,{control:g.control,name:"indexes",rules:{required:!0},render:({field:d})=>e.jsxs("label",{children:[o("props.indexes"),e.jsx(X,{disabled:r==="edit",className:"w-full",multiple:!0,defaultValue:[],value:d.value,onChange:h=>d.onChange(h),placeholder:o("form.indexes.placeholder"),children:j.map(h=>e.jsx(X.Option,{value:h.uid,children:h.uid},h.uid))})]})})}),e.jsx(ee,{placement:"bottom-start",content:o("form.actions.tip"),children:e.jsx(P,{control:g.control,name:"actions",rules:{required:!0},render:({field:d})=>e.jsxs("label",{children:[o("props.actions"),e.jsx(X,{disabled:r==="edit",className:"w-full",multiple:!0,defaultValue:[],value:d.value,onChange:h=>d.onChange(h),placeholder:o("form.actions.placeholder"),children:[{value:"search",label:"search"},{value:"documents.add",label:"documents.add"},{value:"documents.get",label:"documents.get"},{value:"documents.delete",label:"documents.delete"},{value:"indexes.create",label:"indexes.create"},{value:"indexes.get",label:"indexes.get"},{value:"indexes.update",label:"indexes.update"},{value:"indexes.delete",label:"indexes.delete"},{value:"tasks.get",label:"tasks.get"},{value:"settings.get",label:"settings.get"},{value:"settings.update",label:"settings.update"},{value:"stats.get",label:"stats.get"},{value:"dumps.create",label:"dumps.create"},{value:"version",label:"version"},{value:"keys.get",label:"keys.get"},{value:"keys.create",label:"keys.create"},{value:"keys.update",label:"keys.update"},{value:"keys.delete",label:"keys.delete"}].map(h=>e.jsx(X.Option,{value:h.value,children:h.label},h.value))})]})})}),e.jsx(ee,{placement:"bottom-start",content:o("form.expiresAt.tip"),children:e.jsx(P,{control:g.control,name:"expiresAt",rules:{validate:d=>d&&z(d).isValid()?!0:(g.setError("expiresAt",{message:o("form.expireAt.invalid")}),!1)},render:({field:d})=>e.jsxs("label",{children:[o("expired_at"),e.jsx(et,{disabled:r==="edit",className:"w-full",position:"top",zIndex:5e3,value:d.value??z().toDate(),onChange:(h,x)=>{console.log(h,x),g.setValue("expiresAt",h)},type:"dateTime"})]})})}),e.jsx(w,{type:"submit",variant:"solid",size:"sm",color:"primary",disabled:l,children:o("common:submit")})]})},En=()=>{var u,d;const{t}=b("key"),s=C(),i=T(),n=i==null?void 0:i.host,[o,a]=c.useReducer((h,x)=>({...h,...x}),{visible:!1,type:"create"}),[r,l]=c.useReducer((h,x)=>({...h,...x}),{pageSize:20,currentPage:1}),m=O({queryKey:["keys",n,r],queryFn:async()=>(H(),console.debug(s.config,r),await s.getKeys({limit:r.pageSize,offset:(r.currentPage-1)*r.pageSize}))});c.useEffect(()=>{m.isError&&console.warn("get meilisearch keys error",m.error),m.isFetching||W()},[m.error,m.isError,m.isFetching]);const p=c.useCallback(()=>{setTimeout(()=>{m.refetch().then()},1e3)},[m]),j=c.useCallback(h=>{E.confirm({title:t("delete.title"),centered:!0,content:e.jsx("p",{children:t("delete.tip")}),onOk:async()=>{s.deleteKey(h.uid).finally(()=>{p()})},okText:t("confirm"),cancelText:t("cancel")})},[s,p,t]),g=[{title:t("name"),dataIndex:"name",width:200},{title:t("props.key"),dataIndex:"key",width:120,render:h=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{children:h.replace(/^(.{8})(?:\S+)(.{6})$/,"$1****$2")}),e.jsx(Qt,{value:h,timeout:200,children:({copied:x,copy:f})=>e.jsx(ee,{content:t(x?"copied":"copy"),placement:"right",children:e.jsx(G,{color:x?"teal":"gray",variant:"transparent",onClick:f,children:x?e.jsx(Tt,{size:16}):e.jsx(ze,{size:16})})})})]})},{title:t("props.indexes"),dataIndex:"indexes",width:170,render:(h,x)=>e.jsx(Ke,{maxTagCount:3,tagList:x.indexes.map(f=>({children:f})),showPopover:!0})},{title:t("props.actions"),dataIndex:"actions",width:180,render:(h,x)=>e.jsx(Ke,{maxTagCount:3,tagList:x.actions.map(f=>({children:f})),showPopover:!0})},{title:t("expired_at"),dataIndex:"expiresAt",width:200,render:(h,x)=>B(x.expiresAt,{defaultText:t("forever")})},{title:t("actions"),dataIndex:"operate",render:(h,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:"sm",onClick:()=>{E.info({title:t("common:detail"),centered:!0,footer:null,content:e.jsxs(K,{className:"pb-3",children:[e.jsx(K.Item,{itemKey:"UID",children:x.uid}),e.jsx(K.Item,{itemKey:t("description"),children:x.description}),e.jsx(K.Item,{itemKey:t("created_at"),children:e.jsx(oe,{date:x.createdAt})}),e.jsx(K.Item,{itemKey:t("updated_at"),children:e.jsx(oe,{date:x.updatedAt})})]})})},variant:"flat",children:t("common:detail")}),e.jsx(w,{size:"sm",variant:"flat",onClick:()=>{a({visible:!0,type:"edit",editing:x})},children:t("common:edit")}),e.jsx(w,{color:"warning",size:"sm",onClick:()=>{j(x)},variant:"flat",children:t("common:delete")})]})}];return e.jsx("div",{className:"flex-1 overflow-scroll max-h-fit",children:e.jsxs("main",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsx(w,{variant:"solid",color:"primary",size:"sm",onClick:()=>{a({visible:!0,type:"create"})},children:t("common:create")}),e.jsx(Ze,{size:"small",pageSize:r.pageSize,total:(u=m.data)==null?void 0:u.total,currentPage:r.currentPage,onPageChange:h=>{l({currentPage:h}),m.refetch()}})]}),e.jsx(tt,{columns:g,dataSource:(d=m.data)==null?void 0:d.results,pagination:!1,empty:t("empty")}),e.jsx(E,{visible:o.visible,onCancel:()=>{a({visible:!1})},closable:!1,footer:!1,children:e.jsx(Tn,{afterSubmit:()=>{p(),a({visible:!1})},data:o.editing?{...o.editing,name:o.editing.name??""}:void 0,type:o.type})})]})})},Ln=R("/ins/$insID/_layout/keys")({component:En,pendingComponent:A}),Y=t=>{const{history:s}=Fe(),{t:i,i18n:n}=b("index"),{indexUID:o,insID:a}=nt({strict:!1}),r=as({queryKey:["index",a,o],queryFn:async()=>(console.debug("getting current index",t.config),await t.getIndex(o))}),l=c.useMemo(()=>r.isFetched&&!I.isEmpty(r.data),[r.data,r.isFetched]);return c.useEffect(()=>{r.isFetched&&I.isEmpty(r.data)&&(console.debug("useCurrentIndex","lost index",r.data),D.error(`${i("not_found")} 🤥`),s.back())},[s,r.data,r.isFetched,n.resolvedLanguage,i]),{index:r.data,ready:l,query:r}},$n=({afterMutation:t})=>{const{t:s}=b("index"),i=C(),n=Y(i),o=je({initialValues:{primaryKey:n.index.primaryKey}}),[a,r]=c.useState(!1),l=()=>{r(!0)},m=()=>{r(!1),o.reset()},p=c.useCallback(async j=>{let g;try{g=await n.index.update({primaryKey:j.primaryKey}),console.info(g),I.isEmpty(g)||(F(g),t())}catch(u){console.warn(u),D.error(s("toast.fail",{msg:u}))}},[t,n.index,o,s]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-1 items-center",children:[n.index.primaryKey?e.jsx(be,{children:n.index.primaryKey}):s("common:none"),e.jsx("div",{className:"i-lucide:edit w-1em h-1em cursor-pointer hover:scale-90 transition",onClick:()=>{l()}})]}),e.jsx(E,{centered:!0,footerFill:!0,visible:a,title:s("update")+s("primaryKey"),okText:s("submit"),cancelText:s("common:cancel"),afterClose:()=>{m()},onOk:async()=>{await p(o.values),m()},onCancel:m,children:e.jsx("form",{className:"pt-3 space-y-3",children:e.jsx(J,{position:"bottomLeft",content:s("create_index.form.primaryKey.tip"),children:e.jsx(Z,{addonBefore:s("primaryKey"),...o.getInputProps("primaryKey")})})})})]})},Ce=({value:t,label:s})=>e.jsxs("div",{className:"px-2 text-xs font-400",children:[e.jsx("p",{className:"text-sm font-600",children:s}),t]});function Pn(){const{t}=b("index"),s=C(),i=Y(s);return console.debug("index dash page building",i),c.useMemo(()=>{var n,o,a;return e.jsxs("div",{className:"flex-1 grid grid-cols-5 laptop:grid-cols-7 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex flex-col gap-4 border-r",children:[e.jsx(pt,{className:"scale-90",children:`${(n=i.index)==null?void 0:n.uid}`}),e.jsx(Ce,{label:"UID",value:e.jsx(be,{children:((o=i.index)==null?void 0:o.uid)||""})}),e.jsx(Ce,{label:t("common:updated_at"),value:e.jsx(oe,{date:(a=i.index)==null?void 0:a.updatedAt})}),i.index&&e.jsx(Ce,{label:t("primaryKey"),value:e.jsx($n,{afterMutation:()=>{window.location.reload()}})}),e.jsxs("div",{className:"flex flex-col gap-3 items-stretch",children:[e.jsx(U,{to:"",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:square-kanban w-1em h-1em"}),e.jsx("div",{children:t("dashboard")})]})})}),e.jsx(U,{to:"documents",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:book-text w-1em h-1em"}),e.jsx("div",{children:t("documents")})]})})}),e.jsx(U,{to:"setting",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:settings w-1em h-1em"}),e.jsx("div",{children:t("settings")})]})})}),e.jsx(U,{to:"documents/upload",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:upload w-1em h-1em"}),e.jsx("div",{children:t("document:upload_documents")})]})})})]})]}),e.jsx("div",{className:"col-start-2 -col-end-1 overflow-hidden",children:e.jsx(Oe,{})})]})},[i.index,t])}const zn=R("/ins/$insID/_layout/index/$indexUID/_layout")({component:Pn,pendingComponent:A}),On=()=>{const{t}=b("index"),s=C(),i=Y(s),n=Ae(s),o=(n==null?void 0:n.indexes[i.index.uid].fieldDistribution)??{};return e.jsx("div",{className:"grid grid-cols-6 h-full overflow-scroll",children:e.jsxs("main",{className:"p-4 laptop:col-start-2 laptop:-col-end-2 col-start-1 -col-end-1 flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col gap-4 px-1",children:e.jsx(js,{title:e.jsx("div",{className:"text-1rem text-black font-bold",children:t("count")}),value:n==null?void 0:n.indexes[i.index.uid].numberOfDocuments,countUp:!0,loading:!(n!=null&&n.indexes[i.index.uid]),styleValue:{color:"green"},groupSeparator:!0})}),e.jsx(Is,{option:{title:{text:`${t("fieldDistribution.label")} (${t("fieldDistribution.tip")})`,textStyle:{fontSize:"1rem",color:"black"},subtext:t("fieldDistribution.subtitle"),sublink:"https://www.meilisearch.com/docs/reference/api/stats"},legend:{top:"50%",left:"right",orient:"vertical"},tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},toolbox:{show:!0,feature:{mark:{show:!0},saveAsImage:{show:!0}}},series:[{type:"pie",radius:[50,250],center:["50%","50%"],roseType:"area",itemStyle:{normal:{borderRadius:8,label:{show:!0,position:"inner",formatter:function(a){return`${a.name}(${a.value})`}},labelLine:{show:!1}}},data:Object.entries(o).map(([a,r])=>({name:a,value:r})).sort((a,r)=>r.value-a.value).slice(0,10)}]},notMerge:!0,lazyUpdate:!0,className:"!h-full"})]})})},Fn=R("/ins/$insID/_layout/index/$indexUID/_layout/")({component:On,pendingComponent:A}),Mn=({className:t})=>{const{t:s}=b("index"),i=C(),n=Y(i),o=c.useRef(null),[a,r]=c.useState(!1),l=c.useCallback(()=>{r(!0)},[]),[m,p]=c.useState({}),[j,g]=c.useState(m),u=c.useCallback((v={})=>{var _;r(!1),p(v),a||(g(v),(_=o.current)==null||_.setValue(JSON.stringify(v,null,2)))},[a]),d=O({queryKey:["settings",i.config.host,n.index.uid],queryFn:async()=>(H(),await n.index.getSettings())});c.useEffect(()=>{d.isSuccess&&!a&&u(d.data),d.isFetching||W()},[a,d.data,d.isFetching,d.isSuccess,u]);const h=c.useCallback(v=>v&&g(JSON.parse(v)),[g]),x=te({mutationFn:async v=>(H(),await n.index.updateSettings(v)),onSuccess:v=>{F(v),setTimeout(()=>d.refetch(),450)},onSettled:()=>{W()}}),f=c.useCallback(()=>{r(!1),j&&x.mutate(j)},[j,x]),y=c.useMemo(()=>d.isLoading||d.isFetching||x.isPending,[d.isFetching,d.isLoading,x.isPending]);return c.useMemo(()=>e.jsxs("div",{className:S(t,"p-1"),children:[e.jsxs("div",{className:"flex items-center gap-4 w-full pb-2",children:[e.jsxs("div",{className:"text-xl font-medium mr-auto flex items-center gap-2",children:[e.jsxs("p",{children:["JSON ",s("setting.index.config.label")]}),e.jsx("a",{href:"https://www.meilisearch.com/docs/reference/api/settings",target:"_blank",rel:"noreferrer",children:e.jsx("div",{className:"i-lucide:circle-help w-1em h-1em text-neutral-400"})})]}),!a&&e.jsx(w,{variant:"flat",size:"sm",color:"primary",onClick:()=>{l()},isLoading:y,children:s("edit")}),a&&e.jsx(w,{variant:"flat",size:"sm",color:"success",onClick:()=>{f()},isLoading:y,children:s("save")}),a&&e.jsx(w,{variant:"flat",size:"sm",color:"default",onClick:()=>{u()},children:s("cancel")})]}),e.jsx(Me,{language:"json",className:S("h-[30rem]",!a&&"opacity-50"),defaultValue:JSON.stringify(m,null,2),options:{automaticLayout:!0,lineDecorationsWidth:1,readOnly:!a},onChange:h,onMount:v=>{o.current=v}})]}),[t,s,a,y,m,h,l,f,u])},An=({afterMutation:t})=>{const{t:s}=b("index"),i=st(),n=T(),o=C(),a=Y(o),r=te({mutationFn:async()=>(H(),await a.index.delete()),onSuccess:m=>{F(m),t(),i({to:`/ins/${n.id}`})},onSettled:()=>{W()}}),l=te({mutationFn:async()=>(H(),await a.index.deleteAllDocuments()),onSuccess:m=>{F(m),t()},onSettled:()=>{W()}});return c.useMemo(()=>e.jsxs("div",{className:"bg-rose-200 p-3 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-rose-900 text-lg font-bold",children:s("setting.index.danger_zone")}),e.jsx("div",{className:"flex flex-col items-start gap-4",children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(w,{variant:"solid",color:"danger",size:"sm",onClick:()=>{E.confirm({title:s("index_delete.dialog.title"),centered:!0,content:e.jsx("span",{dangerouslySetInnerHTML:{__html:s("index_delete.dialog.content",{uid:a.index.uid})}}),onOk:async()=>r.mutate(),okText:s("confirm"),cancelText:s("cancel")})},children:s("all_documents_delete.label")}),e.jsx(w,{variant:"solid",color:"danger",size:"sm",onClick:()=>E.confirm({title:s("all_documents_delete.dialog.title"),centered:!0,content:e.jsx("span",{dangerouslySetInnerHTML:{__html:s("all_documents_delete.dialog.content",{uid:a.index.uid})}}),onOk:async()=>l.mutate(),okText:s("confirm"),cancelText:s("cancel")}),children:s("index_delete.label")})]})})]}),[s,a.index.uid,r,l])},qn=()=>e.jsx("div",{className:"grid grid-cols-6 h-full overflow-scroll",children:e.jsx("main",{className:"p-4 laptop:col-start-2 laptop:-col-end-2 col-start-1 -col-end-1 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col gap-4 px-1",children:[e.jsx(Mn,{}),e.jsx(An,{afterMutation:()=>window.location.reload()})]})})}),Kn=R("/ins/$insID/_layout/index/$indexUID/_layout/setting")({component:qn,pendingComponent:ve}),Un=({doc:t,onClickDocumentDel:s,onClickDocumentUpdate:i})=>{const{t:n}=b("document");return e.jsxs("div",{className:"text-xs rounded-xl p-4 bg-primary-50 odd:bg-opacity-20 even:bg-opacity-10 group relative",children:[e.jsx(rt,{name:!1,displayDataTypes:!1,displayObjectSize:!1,src:t.content,collapsed:3,collapseStringsAfterLength:50}),e.jsxs("div",{className:"absolute right-0 bottom-0 opacity-95 invisible group-hover:visible p-2 flex items-center gap-2",children:[e.jsx(se,{type:"secondary",size:"mini",status:"warning",onClick:()=>i(t),children:n("common:update")}),e.jsx(se,{type:"secondary",size:"mini",status:"danger",onClick:()=>s(t),children:n("common:delete")})]})]})},Vn=({doc:t,onClickDocumentDel:s,onClickDocumentUpdate:i})=>{const{t:n}=b("document");return e.jsxs("div",{className:"rounded-xl px-3 py-5 bg-primary-50/20 border border-transparent hover:border-primary group relative overflow-hidden",children:[e.jsx(K,{data:Object.entries(t.content).map(([o,a])=>({key:o,value:e.jsx(ht,{name:o,value:a})}))}),e.jsxs("div",{className:"absolute right-0 bottom-0 opacity-95 invisible group-hover:visible p-1.5 flex items-center gap-2",children:[e.jsx(se,{type:"secondary",size:"mini",status:"warning",onClick:()=>i(t),children:n("common:update")}),e.jsx(se,{type:"secondary",size:"mini",status:"danger",onClick:()=>s(t),children:n("common:delete")})]})]})},ht=({name:t,value:s,dateParser:i=!0})=>{let n=I.toString(s).trim();return I.isObjectLike(s)&&(n=mn(s)),e.jsx("div",{className:"cursor-pointer",onClick:()=>{E.info({title:t,centered:!0,content:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(be,{className:"overflow-scroll whitespace-pre-wrap text-balance break-words",children:n}),We(n)&&e.jsx(Ue,{width:"100%",src:n})]})})},children:i&&/^.*(date|time).*$/gim.test(t)&&He(n)?B(He(n)):We(n)?e.jsx(Ue,{width:"100%",src:n,preview:!1}):I.truncate(n,{length:20})})},Bn=({docs:t=[],refetchDocs:s,type:i="json"})=>{const{t:n}=b("document"),o=C(),[a,r]=c.useState(),l=te({mutationFn:async({indexId:u,docs:d})=>await o.index(u).updateDocuments(d),onSuccess:u=>{F(u),s()},onError:u=>{console.error(u),Pe(u)}}),m=te({mutationFn:async({indexId:u,docId:d})=>await o.index(u).deleteDocuments(d),onSuccess:u=>{F(u),s()},onError:u=>{console.error(u),Pe(u)}}),p=c.useCallback(u=>{const d=u.primaryKey;console.debug("onClickDocumentDel","pk",d),d?E.confirm({title:n("delete_document"),centered:!0,content:e.jsx("p",{dangerouslySetInnerHTML:{__html:n("delete.tip",{indexId:u.indexId,primaryKey:u.content[d]})}}),okText:n("confirm"),cancelText:n("cancel"),onOk:()=>{m.mutate({indexId:u.indexId,docId:[u.content[d]]})}}):D.error(n("delete.require_primaryKey",{indexId:u.indexId}))},[m,n]),j=c.useCallback((u="[]")=>r(d=>({...d,content:JSON.parse(u)})),[]),g=c.useCallback(u=>{const d=u.primaryKey;console.debug("onClickDocumentUpdate","pk",d),d&&E.confirm({title:n("edit_document"),centered:!0,size:"large",content:e.jsx("div",{className:"border rounded-xl p-2",children:e.jsx(Me,{language:"json",className:"h-80",defaultValue:JSON.stringify((u==null?void 0:u.content)??{},null,2),options:{automaticLayout:!0,lineDecorationsWidth:1},onChange:j})}),okText:n("submit"),cancelText:n("cancel"),onOk:()=>{a&&l.mutate({indexId:a.indexId,docs:[a.content]})}})},[l,a,j,n]);return c.useMemo(()=>i==="table"?e.jsx("div",{children:e.jsx(ys,{columns:[...new Set(t.reduce((u,d)=>u.concat(Object.keys(d.content)),[t[0].primaryKey]))].map(u=>({title:u,dataIndex:u,width:"10rem",ellipsis:!0,render(d,h){return e.jsx(ht,{name:u,value:h[u],dateParser:!1})}})).concat([{title:n("common:actions"),fixed:"right",align:"center",width:"8rem",render:(u,d,h)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{type:"secondary",size:"mini",status:"warning",onClick:()=>g(t[h]),children:n("common:update")}),e.jsx(se,{type:"secondary",size:"mini",status:"danger",onClick:()=>p(t[h]),children:n("common:delete")})]})}]),data:t.map(u=>({...u.content})),stripe:!0,hover:!0,virtualized:!0,pagination:!1,size:"small",scroll:{x:!0,y:!0}})}):i==="grid"?e.jsx("div",{className:"grid grid-cols-3 laptop:grid-cols-4 gap-3",children:t.map((u,d)=>e.jsx(Vn,{doc:u,onClickDocumentDel:p,onClickDocumentUpdate:g},d))}):e.jsx(e.Fragment,{children:t.map((u,d)=>e.jsx(Un,{doc:u,onClickDocumentDel:p,onClickDocumentUpdate:g},d))}),[t,p,g,n,i])},Jn=({searchForm:t,searchFormError:s,onFormSubmit:i,submitBtnText:n,indexIdEnable:o=!1,isFetching:a,onAutoRefreshChange:r})=>{const{t:l}=b("document");return c.useMemo(()=>e.jsxs("form",{className:"flex flex-col gap-2 ",onSubmit:i,children:[e.jsxs("div",{className:it("prompt danger ghost xs",!s&&"hidden"),children:[e.jsx("div",{className:"icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-alert-triangle",width:18,height:18,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M10.24 3.957l-8.422 14.06a1.989 1.989 0 0 0 1.7 2.983h16.845a1.989 1.989 0 0 0 1.7 -2.983l-8.423 -14.06a1.989 1.989 0 0 0 -3.4 0z"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 17h.01"})]})}),e.jsx("div",{className:"content",children:e.jsx("p",{children:s})})]}),o&&e.jsx(he,{leftSection:e.jsx(Et,{size:16}),radius:"md",placeholder:l("search.form.indexId.placeholder"),required:!0,...t.getInputProps("indexId")}),e.jsx(he,{leftSection:e.jsx(Lt,{size:16}),autoFocus:!0,radius:"md",placeholder:l("search.form.q.placeholder"),...t.getInputProps("q")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(he,{className:"flex-1",label:l("search.form.filter.label"),leftSection:e.jsx($t,{size:16}),radius:"md",...t.getInputProps("filter")}),e.jsx(J,{content:l("search.form.sort.tip"),children:e.jsx(he,{className:"flex-1",label:l("search.form.sort.label"),leftSection:e.jsx(Pt,{size:16}),radius:"md",...t.getInputProps("sort")})})]}),e.jsxs("div",{className:"flex items-stretch gap-4",children:[e.jsx(Ve,{radius:"md",label:l("search.form.limit.label"),...t.getInputProps("limit")}),e.jsx(Ve,{radius:"md",label:l("search.form.offset.label"),...t.getInputProps("offset")}),e.jsxs("div",{className:"ml-auto mt-auto flex gap-x-4 items-center",children:[e.jsx(J,{position:"bottom",content:l("search.form.autoRefresh.tip"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",defaultChecked:!1,children:l("search.form.autoRefresh.label")}),e.jsx(Ut,{loading:a,onChange:m=>r(m)})]})}),e.jsx(w,{type:"submit",size:"sm",color:"primary",children:n})]})]})]}),[i,s,o,l,t,a,n,r])},Hn=({data:t,fileName:s,fileType:i})=>{const n=new Blob([t],{type:i}),o=document.createElement("a");o.download=s,o.href=window.URL.createObjectURL(n);const a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(a),o.remove()},Wn=(t,s)=>{Hn({data:JSON.stringify(t),fileName:`${s}.json`,fileType:"text/json"})},ge={hits:[],estimatedTotalHits:0,processingTimeMs:0},Qn=({currentIndex:t})=>{var y,v,_;const{t:s}=b("document"),[i,n]=c.useState("json"),[o,a]=c.useState(!1),[r,l]=c.useState(null),m=T(),p=m==null?void 0:m.host,j=C(),g=c.useMemo(()=>t?j.index(t):void 0,[j,t]),u=je({initialValues:{q:"",offset:0,limit:20,filter:"",sort:""},validate:{limit:N=>N<500?null:s("search.form.limit.validation_error")}}),d=O({queryKey:["indexPrimaryKey",p,g==null?void 0:g.uid],queryFn:async()=>{var N;return(N=await(g==null?void 0:g.getRawInfo()))==null?void 0:N.primaryKey},enabled:!!t}),h=_s(u.values,{wait:450}),x=O({queryKey:["searchDocuments",p,g==null?void 0:g.uid],refetchInterval:o?7e3:!1,refetchOnMount:o,refetchOnWindowFocus:o,refetchOnReconnect:o,queryFn:async()=>{const{q:N,limit:de,offset:ue,filter:me,sort:L=""}={...u.values,...h};if(u.validate().hasErrors)return ge;const qe=L.match(/(([\w\.]+)|(_geoPoint\([\d\.,\s]+\))){1}\:((asc)|(desc))/g)||[];console.debug("search sorting expression",L,qe);try{const Ie=await g.search(N,{limit:de,offset:ue,filter:me,sort:qe.map(q=>q.trim())});return l(null),Ie||ge}catch(Ie){const q=Ie.message;return l(null),q.match(/filter/i)?u.setFieldError("filter",q):q.match(/sort/i)?u.setFieldError("sort",q):l(q),ge}},enabled:!!t}),f=c.useCallback(async()=>{await x.refetch()},[x]);return c.useEffect(()=>{o&&x.refetch()},[h]),c.useMemo(()=>{var N,de,ue,me;return e.jsxs("div",{className:"h-full flex flex-col p-4 gap-4 overflow-hidden",children:[e.jsx("div",{className:`rounded-lg ${x.isFetching?"rainbow-ring-rotate":""}`,children:e.jsx("div",{className:"rounded-lg p-4 border",children:e.jsx(Jn,{onAutoRefreshChange:L=>a(L),isFetching:x.isFetching,searchForm:u,searchFormError:r,onFormSubmit:u.onSubmit(f),submitBtnText:s("common:search")})})}),e.jsx("div",{className:"h-px w-full bg-neutral-200 scale-x-150"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("p",{className:"font-extrabold text-2xl",children:s("search.results.label")}),e.jsxs(Vt,{type:"button",buttonSize:"middle",defaultValue:i,onChange:L=>n(L.target.value),children:[e.jsx(_e,{value:"json",children:"JSON"}),e.jsx(_e,{value:"table",children:s("search.results.type.table")}),e.jsx(_e,{value:"grid",children:s("search.results.type.grid")})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3 px-4 font-light text-xs text-neutral-500",children:[e.jsxs(Se,{type:"secondary",size:"small",onClick:()=>{var L;return Wn(((L=x.data)==null?void 0:L.hits)||ge.hits,"search-results")},children:[s("search.results.download")," ",`(${((N=x.data)==null?void 0:N.hits.length)||0})`]}),e.jsx("p",{children:s("search.results.total_hits",{estimatedTotalHits:(de=x.data)==null?void 0:de.estimatedTotalHits})}),e.jsx("p",{children:s("search.results.processing_time",{processingTimeMs:(ue=x.data)==null?void 0:ue.processingTimeMs})})]})]}),e.jsx("div",{className:"flex flex-col gap-4 overflow-scroll",children:x.isFetching?e.jsx("div",{className:"flex-1 flex justify-center items-center",children:e.jsx(ve,{})}):e.jsx(Bn,{type:i,docs:(me=x.data)==null?void 0:me.hits.map(L=>({indexId:t,content:L,primaryKey:d.data})),refetchDocs:x.refetch})})]})},[x.isFetching,(y=x.data)==null?void 0:y.estimatedTotalHits,(v=x.data)==null?void 0:v.processingTimeMs,(_=x.data)==null?void 0:_.hits,x.refetch,u,r,f,s,i,t,d.data])},Yn=()=>{const t=C(),s=Y(t);return c.useMemo(()=>e.jsx(Qn,{currentIndex:s.index.uid}),[s.index.uid])},Gn=R("/ins/$insID/_layout/index/$indexUID/_layout/documents/")({component:Yn,pendingComponent:A}),Xn=()=>{const{t}=b("upload"),[s,i]=c.useState("leave"),n=c.useRef(null),o=T(),a=C(),r=Y(a),l=o==null?void 0:o.host,m=o==null?void 0:o.apiKey,p=je({initialValues:{documents:[]},validate:{documents:f=>{if(f instanceof File?f.size>0:f.length>0)return null;{const y=t("documents_json_array_requirement");return D.error(y),y}}}}),j=te({mutationFn:async f=>{const y=new URL(`/indexes/${r.index.uid}/documents`,l),_=await(await fetch(y,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:m?`Bearer ${m}`:""},body:f instanceof File?f:JSON.stringify(f)})).json();return console.debug("addDocumentsMutation","response",_),_},onSuccess:f=>{F(f),p.reset()},onError:f=>{console.error(f),Pe(f)},onMutate(){s!=="uploading"&&(i("uploading"),H())},onSettled(){s==="uploading"&&i("leave"),W()}}),g=c.useCallback(async()=>{const[f]=await navigator.clipboard.read();if(f.types.includes("text/plain")){const y=JSON.parse(await(await f.getType("text/plain")).text()),v=I.isArray(y)?y:I.isObject(y)?[y]:[];console.debug("onAddDocumentsByEditorClick paste clipboard",v,y),v.length>0&&n&&(n.current.setValue(JSON.stringify(v,null,2)),D.success(t("clipboard_json_pasted")))}},[t]),u=c.useCallback(async f=>{await j.mutate(f.documents)},[p,j]),d=c.useCallback(async()=>{if(s==="uploading")return;const f=document.getElementById("documents-json-file-selector");f&&(f.click(),await f.addEventListener("change",async y=>{const v=y.target.files[0];console.debug("onImportAreaClick","file-change",v),await u({documents:v})},!1))},[s,u]),h=c.useCallback(async f=>{if(f.preventDefault(),s==="uploading")return;const y=f.dataTransfer.files[0];console.debug("onImportAreaDrop","drop",y),await u({documents:y})},[s,u]),x=c.useCallback((f="[]")=>p.setFieldValue("documents",JSON.parse(f)),[p]);return c.useMemo(()=>e.jsx("div",{className:`overflow-hidden fill 
        flex flex-col items-stretch rounded-3xl gap-4`,children:e.jsxs("div",{className:"flex-1 flex gap-4 p-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t("input_by_editor")}),e.jsx(V,{size:"small",children:t("manually_type_in")}),e.jsx(at,{content:t("click_to_paste_clipboard_content_if_it_is_valid_json"),position:"bottom",children:e.jsx(ze,{className:"cursor-pointer",size:"1em",onClick:()=>g()})})]}),e.jsxs("form",{className:"flex-1 flex flex-col gap-y-4 overflow-hidden",onSubmit:p.onSubmit(u),children:[e.jsx("div",{className:"border rounded-xl p-2 overflow-scroll",children:e.jsx(Me,{language:"json",className:"h-[32rem]",defaultValue:JSON.stringify(p.values.documents,null,2),options:{automaticLayout:!0,lineDecorationsWidth:1},onChange:x,onMount:f=>{console.debug("editorDidMount",f,f.getValue(),f.getModel()),n.current=f}})}),e.jsx(w,{type:"submit",color:"success",children:t("submit")})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"only-one-line flex items-center",children:[e.jsx("span",{className:"pr-2",children:t("import_json_file")}),e.jsx(V,{size:"small",children:t("for_large_documents")})]}),e.jsxs("div",{className:S("flex-1 flex flex-col justify-center items-center gap-4","rounded-2xl !border-4 border-dashed  border-neutral-500","transition-colors duration-500","drag-json-file-area",s!=="uploading"?"cursor-pointer":"cursor-not-allowed",{"border-green-600":s==="over","border-rose-600":s==="uploading"}),onClick:()=>d(),onDrop:h,onDragOver:f=>{f.preventDefault(),i("over")},onDragLeave:f=>{f.preventDefault(),i("leave")},children:[e.jsx("h6",{className:"text-2xl",children:s==="over"?e.jsx(e.Fragment,{children:t("release_to_upload_documents")}):s==="uploading"?e.jsxs(e.Fragment,{children:[t("uploading"),"..."]}):e.jsx("span",{dangerouslySetInnerHTML:{__html:t("drag_and_drop_a_file_here",{type:'<strong class="underline">JSON</strong>'})}})}),e.jsx("span",{children:t("or")}),e.jsx(w,{variant:"bordered",color:s==="over"?"success":s==="uploading"?"danger":"default",disabled:s==="uploading",children:t("browse_file")}),e.jsx("input",{type:"file",id:"documents-json-file-selector",accept:".json",className:"hidden",multiple:!1,min:1,max:1})]})]})]})}),[p,s,x,u,d,h,g,t])},Zn=R("/ins/$insID/_layout/index/$indexUID/_layout/documents/upload")({component:Xn,pendingComponent:A}),ei=R("/ins/$insID")(),ti=R("/ins/$insID/_layout/index/$indexUID")(),si=ln.update({path:"/warning",getParentRoute:()=>ye}),ni=pn.update({path:"/",getParentRoute:()=>ye}),ft=ei.update({path:"/ins/$insID",getParentRoute:()=>ye}),le=bn.update({id:"/_layout",getParentRoute:()=>ft}),ii=Nn.update({path:"/",getParentRoute:()=>le}),oi=Sn.update({path:"/tasks",getParentRoute:()=>le}),ai=Ln.update({path:"/keys",getParentRoute:()=>le}),gt=ti.update({path:"/index/$indexUID",getParentRoute:()=>le}),ce=zn.update({id:"/_layout",getParentRoute:()=>gt}),ri=Fn.update({path:"/",getParentRoute:()=>ce}),li=Kn.update({path:"/setting",getParentRoute:()=>ce}),ci=Gn.update({path:"/documents/",getParentRoute:()=>ce}),di=Zn.update({path:"/documents/upload",getParentRoute:()=>ce}),ui={InsInsIDLayoutIndexIndexUIDLayoutSettingRoute:li,InsInsIDLayoutIndexIndexUIDLayoutIndexRoute:ri,InsInsIDLayoutIndexIndexUIDLayoutDocumentsUploadRoute:di,InsInsIDLayoutIndexIndexUIDLayoutDocumentsIndexRoute:ci},mi=ce._addFileChildren(ui),xi={InsInsIDLayoutIndexIndexUIDLayoutRoute:mi},pi=gt._addFileChildren(xi),hi={InsInsIDLayoutKeysRoute:ai,InsInsIDLayoutTasksRoute:oi,InsInsIDLayoutIndexRoute:ii,InsInsIDLayoutIndexIndexUIDRoute:pi},fi=le._addFileChildren(hi),gi={InsInsIDLayoutRoute:fi},ji=ft._addFileChildren(gi),yi={IndexRoute:ni,WarningRoute:si,InsInsIDRoute:ji},vi=ye._addFileChildren(yi)._addFileTypes();function bi(){const{history:t}=Fe(),{t:s}=b();return e.jsxs("div",{className:"full-page bg-mount gap-y-10 justify-center items-center",children:[e.jsx(re,{}),e.jsx("h1",{className:"text-primary-100 font-bold",children:"404 Page Not Found"}),e.jsx("div",{className:"",children:e.jsx(Re,{variant:"gradient",color:"blue",onClick:()=>t.back(),children:s("back")})}),e.jsx(ae,{})]})}const jt=new rs({defaultOptions:{queries:{throwOnError:!0,refetchIntervalInBackground:!1,refetchOnReconnect:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",refetchInterval:3e4}}}),Ii=ls({routeTree:vi,basepath:"/",context:{queryClient:jt},defaultPreload:"intent",defaultPendingComponent:()=>e.jsx("div",{className:"h-dvh flex justify-center items-center",children:e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx(re,{className:"shrink"}),e.jsx("div",{className:"my-2 min-h-10 w-0.5 bg-neutral-300"}),e.jsx(ve,{})]})}),defaultPreloadStaleTime:0,defaultNotFoundComponent:bi}),Ge=document.getElementById("root");Ge.innerHTML||vt.createRoot(Ge).render(e.jsx(yt.StrictMode,{children:e.jsxs(cs,{client:jt,children:[e.jsx(Ps,{children:e.jsx(ds,{router:Ii})}),e.jsx(us,{initialIsOpen:!1})]})}));
