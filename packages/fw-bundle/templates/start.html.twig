{% extends "@SurvosFw/base.html.twig" %}

{% block stylesheets %}
{#    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/survosFw/style.css') }}" />#}
    {{ parent() }}
{% endblock %}

{# this is one approach, but we're not using it now.  Instead, look at the body to load the initial page #}

{% block body %}


        {% set globals = {
            config: config,
            configCode: configCode,
            locale: app.request.locale,
        } %}

        <twig:dexie
                :initDb="true"
                refreshEvent="dexie:load"
                :globals="globals"
                :store="{}|json_encode"
                :filter="{}"
                :caller="_self">
{#            <twig:block name="title">#}
{#                Loading {{ store.url }}#}
{#            </twig:block>#}

            <twig:block name="twig_template" id="hack_to_get_raw_data">
{#                {% set url = globals.store.url %}#}
{#                <code>{{ globals.store.schema }}</code>#}
{#                @todo: a loading gauge / progress bar for#}
{#                <a href="{{ url }}">{{ globals.store.url }}</a>#}
                <!-- hack_to_get_raw_data -->
            </twig:block>

        </twig:dexie>
    {% set iconMap = dictionary('tab_icons') %}
    <div id="app" {{ stimulus_controller(_app_sc, {
        config: appConfig,
        configCode : configCode,
        locale: app.request.locale,
    }) }}>
        <div class="panel panel-left">

            <div class="popover my-popover">
                <div class="popover-inner">
                    <div class="list inset list-strong list-dividers-ios">
                        <ul>
                            From AppConfig: {{ appConfig.name }}
                            <!-- loop over enabled_locales -->
                            {% for locale in app.enabled_locales %}
                                <li>
                                    <a class="external list-button" href="{{ url('project_start', {configCode: config.code, _locale: locale}) }}">
                                        {{ locale|language_name(locale) }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="list inset list-strong">
                        <ul>
                            <li><a class="list-button color-red popover-close">Cancel</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="list menu-list">
                <ul>
                    <li>
                        <a href="#" class="item-content item-link popover-open" data-popover=".my-popover">
                            <div class="item-media">
                                <twig:ux:icon name="tabler:language-katakana" />
                            </div>
                            <div class="item-inner">
                                <div class="item-title">{{ ('language'|trans)|title }}</div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="refreshDatabase"  class="item-content item-link">
                            <div class="item-media">
                                <twig:ux:icon name="tabler:refresh-dot" />
                            </div>
                            <div class="item-inner">
                                <div class="item-title">Refresh</div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Right panel -->
        <div class="panel panel-right">
            <div class="view view-init panel-view" data-name="panel-view">
            </div>
        </div>

        <!-- Your main view, should have "view-main" class -->
        <div class="view view-main view-init safe-areas">
            <!-- Initial Page, "data-name" contains page name -->
            <div data-name="home" class="page">

                <!-- Top Navbar -->
                <div class="navbar">
                    <div class="navbar-bg"></div>
                    <div class="navbar-inner">
                        <div class="left">
                            <a href="#" class="link icon-only panel-open" data-panel="left">
                                <twig:ux:icon name="tabler:menu-2" />
                            </a>
                        </div>
                        <img style="max-height: 100%" src="{{ globals.config.logo }}" alt="">
                        <div class="title" {{ stimulus_target(_app_sc, 'title') }}>
                            {# {{ globals.config.name }} #}
                        </div>
                        <div class="right">
                            <a href="#" class="link icon-only panel-open" data-panel="right">
                                <twig:ux:icon name="tabler:info-square-rounded" />
                            </a>
                        </div>
                    </div>
                </div>

                <div class="page-content">
                    <div {{ stimulus_target(_app_sc, 'pageTitle') }}>

                    </div>

                    <div style="display: flex; justify-content: center; align-items: center; height: 100%;" id="dataProgress">
                    </div>
                </div>

                <!-- Bottom Toolbar -->
                <div class="toolbar tabbar toolbar-bottom">
                    <div class="toolbar-inner">
                        {% for t in config.tabs %}
                        <a href="#tab-{{ t }}" title="#tab-{{ t }}" class="tab-link ">
                            <twig:ux:icon name="{{iconMap[t]|default('tabler:bug')}}" />
                            {% if app.request.get('debug', false) %}<code>{{ t }}</code>{% endif %}
                            <span class="tabbar-label">
            {{ 'tab.%s'|format(t)|trans|title }}
        </span>
                        </a>

                        {% endfor %}
{#                        {{ component('mobile_menu', {type: MOBILE_TAB_MENU, caller: _self}) }}#}
                    </div>
                </div>

                <div class="tabs">
                    {% for t in config.tabs %}
                        <div id="tab-{{ t }}" class="page-content tab">
                                {{ include('tabs/%s.html.twig'|format(t), {t: t}) }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block templates_experiment %}
    <div class="views tabs safe-areas">
        <!-- Tabbar for switching views-tabs -->
        <div class="toolbar toolbar-bottom">
            <div class="toolbar-inner">
                {{ component('mobile_menu', {type: MOBILE_TAB_MENU, caller: _self}) }}
            </div>
        </div>

        {% for code, template in templates|default([]) %}
            <!-- Your main view/tab, should have "view-main" class. It also has "tab-active" class -->
            <div id="view-{{ code }}" class="view tab {{ loop.first ? 'tab-active view-main '  }}">
                <code>{{ code }}</code>
                {{ template|raw }}
            </div>
        {% endfor %}
    </div>

{% endblock %}
