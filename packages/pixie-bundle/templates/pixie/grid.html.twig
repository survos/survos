{% extends '@SurvosPixie/pixie/layout.html.twig' %}

{% block title %}{{ pixieCode }} Grid{% endblock %}

{% block body %}

    {#    {% set columns = [ #}
    {#        'table', #}
    {#        'label', #}
    {#        'description', #}
    {#        'key', #}
    {#        'country_code', #}
    {#        'name', #}
    {#        'image_url', #}

    {#    ] %} #}
    {% set show_path = show_route??'pixie_show_record' %}
    {% set globals = {
        locale: app.locale,
        pixieCode: pixieCode,
        showPath: show_path,
        showParams: show_params??{locale: app.locale},
        icons: {
            bug : ux_icon("tabler:bug"),
            github: ux_icon("tabler:brand-github")
        }
    } %}
    {{ dump(globals) }}

    <div class="search_builder">
    <twig:api_grid
            :class="class"
            :apiGetCollectionUrl="apiUrl"
            :caller="_self"
            :filter="filter"
            :columns="columns"
            :globals="globals"
    >
        <twig:block name="thumbnail">
            <div class="size-100">
                {% set thumb = row.thumbnail|default(row.image_url|default(false)) %}
                {% if thumb %}
            <img class="img-thumbnail h-100 object-fit-cover size-100"
                 src="{{ thumb }}" />
                {% endif %}
            </div>
        </twig:block>

        <twig:block name="chevron">
            @
            &nbsp;
        </twig:block>
        <twig:block name="attrs">
        </twig:block>
        <twig:block name="tombstone">
            <div class="tombstone custom-heading text-truncate-four-lines">
                {# really the translatable fields #}
                <b>{{ row.title|default(row.label) }}</b>
                <div class="text-truncate-three-line">
                    {{ row.description }}
                </div>
                {% if row.citation %}
                    <a href="{{ row.citation }}" target="_blank">
                        {{ row.credit }}
                    </a>
                {% endif %}
{#                {{ globals.icons|json_encode|raw }}#}
                <div class='d-flex justify-content-between align-items-center gap-2'>
                {% for x in ['url','github','api','wiki'] %}
                    {% if row[x]??false %}
                    <a class="d-flex align-items-center flex-row-reverse gap-2" href="{{ row[x] }}" target="_blank">
{#                        {{ globals|json_encode }}#}
                        {% if x in globals.icons|keys %}
                            {{ x }}
                            {{ globals.icons[x] }}
                            {% else %}
                                {{ x }}:
                            {% endif %}
                        {% set label = row[x]|replace({'https://':'', 'http://':'', 'www.':''}) %}

                        {{ label }}
                    </a>
                    {% endif %}
                {% endfor %}
                </div>

{#                @tombstone links#}
            </div>
        </twig:block>

        <twig:block name="pixie_key">

            {% set lrp =  row.rp|merge({_locale: globals.locale|default('en')}) %}
            {% set pixieItemUrl = path('pixie_show_record', lrp) %}
            <a href="{{ pixieItemUrl }}">
                #<code>{{ row.id }}</code>
            </a>
        </twig:block>
        <twig:block name="id">
            <div style="width: 40px">

                {% set lrp =  row.rp|merge({_locale: globals.locale|default('en')}, globals.showParams) %}
                {% set pixieItemUrl = path(globals.showPath, lrp) %}
                <a href="{{ pixieItemUrl }}">
                    {{ row.id }}
                </a>
            </div>

        </twig:block>
    </twig:api_grid>
    </div>


{% endblock %}
