import{j as e,r as u,R as Nt}from"./react-DLE0P_Nq.js";import{c as Dt}from"./react-dom-Che-H8M2.js";/* empty css                     */import{_ as k,I as Ct,a as St,b as Rt,c as Tt,d as $t,e as Et,f as Lt,g as zt,h as Pt,i as Ue,j as At,k as Ft,l as Ot,m as Mt,n as qt,o as Kt}from"./@tabler-DrI4sfjR.js";import{i as at}from"./i18next-cOPaZ5Oq.js";import{B as Ut}from"./i18next-browser-languagedetector-RoqpcJAD.js";import{r as Vt}from"./i18next-resources-to-backend-arTw0fVe.js";import{l as Bt,a as Jt,L as Wt,T as A,B as ce,b as Ht,M as $,F as te,c as F,P as rt,S as je,D as H,d as Qt,e as ee,f as ot,g as Yt,h as Qe,I as Ye,i as Gt,R as Xt,j as Se}from"./@douyinfe-DUOK_xpI.js";import{i as Zt,u as b}from"./react-i18next-lY0zGp5V.js";import{E as es}from"./react-error-boundary-C4VCJz7Y.js";import{V as I}from"./lodash-7IVhutAX.js";import{M as ts,a as ss,B as ze,m as Re,T as ye,A as Z,u as we,C as ns,b as ve,N as Ge}from"./@mantine-CdmNQL9i.js";import{N as is,i as Te,t as se,b as w,a as as,c as B,d as rs,e as os,f as ls}from"./@nextui-org-ClZNZrJG.js";import{T as cs,J as G}from"./sonner-ujnykqh5.js";import{c as ds,O as Ve,T as us,a as R,u as Be,b as de,d as lt,e as ms,f as M,L as U,k as xs,g as ps,h as ne,Q as hs,i as fs,j as gs,R as js,l as ys}from"./@tanstack-L-Iso0cm.js";import{c as ct}from"./clsx-D-TyrVPw.js";import{a as vs}from"./tailwind-merge-CsDznfHx.js";import{d as E,r as bs,b as Is}from"./dayjs-6KCrTdo0.js";import{m as Pe}from"./meilisearch-1KA7OaL4.js";import{c as ws,d as _s,p as ks}from"./zustand-CnLR_H7H.js";import{p as be}from"./immer-3Uh6AxIC.js";import{D as re}from"./vaul-BduuLnce.js";import{u as dt,C as K}from"./react-hook-form-CxOLOC0H.js";import{L as $e,I as Ns,T as oe,S as Ds,B as ie,a as Cs}from"./@arco-design-D3bBcDqy.js";import{i as Ss}from"./use-immer-BuNP1lWT.js";import{F as Rs}from"./fuse.js-CU2r43ac.js";import{R as ut}from"./react-json-view-DWOhE2jV.js";import{z as T}from"./zod-DXqQCM1T.js";import{E as Ts}from"./echarts-for-react-5zOnsQJw.js";import{F as Je}from"./@monaco-editor-DVGnnzSC.js";import{u as $s}from"./ahooks-wYm_e60b.js";import"./@babel-4gviZBr6.js";import"./scheduler-CzFDRTuY.js";import"./date-fns-C-LZtYhP.js";import"./classnames-DDX9UkiM.js";import"./prop-types-CSW_MYNy.js";import"./@dnd-kit-CpUq43pE.js";import"./date-fns-tz-2Nz3Hr3W.js";import"./fast-copy-oTXv1nHL.js";import"./memoize-one-CcMeOnPo.js";import"./react-window-CG_AG5EW.js";import"./copy-text-to-clipboard-BVJXfyyl.js";import"./react-resizable-DrSWM7VI.js";import"./react-draggable-DHwASX4g.js";import"./bezier-easing-HI0P9lnN.js";import"./react-number-format-CgE9x4Yi.js";import"./@floating-ui-5a-OKKnD.js";import"./react-remove-scroll-rJ1HQWix.js";import"./tslib-DpYiEcgu.js";import"./react-remove-scroll-bar-CXDMel3C.js";import"./react-style-singleton-340SHUf5.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-CjXr77CS.js";import"./use-callback-ref-CV3T9hGv.js";import"./klona-fRfEZ5JV.js";import"./fast-deep-equal-BxCco598.js";import"./@react-aria-CH8kuybn.js";import"./@react-stately-Cz_UvoWO.js";import"./@swc-DS7M6wx8.js";import"./@internationalized-BB0Nk989.js";import"./framer-motion-C9dco-nu.js";import"./tailwind-variants-DDdm4Jbg.js";import"./tiny-invariant-CopsF_GD.js";import"./tiny-warning-Dirz_SfZ.js";import"./use-sync-external-store-B9AFrcTy.js";import"./goober-DovPBWGu.js";import"./@radix-ui-yUilMYjf.js";import"./aria-hidden-DQ5UC2Eg.js";import"./b-tween-BtQQsX34.js";import"./react-is-DcfIKM1A.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./react-transition-group-DAZH3qr6.js";import"./dom-helpers-D0mFdbeO.js";import"./echarts-CJ9wtMP5.js";import"./zrender-DaIPkqCf.js";import"./size-sensor-699oBplG.js";import"./state-local-BBNhjlcY.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const Es=(t,s,n)=>{const i=t[s];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((a,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})},Ls=["en","zh"];var mt=(t=>(t.en="EN",t.zh="ä¸­æ–‡",t))(mt||{});const Xe=["common","dashboard","task","key","upload","document","index","instance","header","sys"];at.use(Vt((t,s)=>Es(Object.assign({"../locales/en/common.json":()=>k(()=>import("./common-COUd-jLf.js"),[]),"../locales/en/dashboard.json":()=>k(()=>import("./dashboard-BQe1Yppc.js"),[]),"../locales/en/document.json":()=>k(()=>import("./document-IqAZJfRk.js"),[]),"../locales/en/footer.json":()=>k(()=>import("./footer-D-L0cnTM.js"),[]),"../locales/en/header.json":()=>k(()=>import("./header-3hOI5g63.js"),[]),"../locales/en/index.json":()=>k(()=>import("./index-DnjB0xWR.js"),[]),"../locales/en/instance.json":()=>k(()=>import("./instance-BtqJ2pS6.js"),[]),"../locales/en/key.json":()=>k(()=>import("./key-CmkBRqIZ.js"),[]),"../locales/en/sys.json":()=>k(()=>import("./sys-BdU-pjYe.js"),[]),"../locales/en/task.json":()=>k(()=>import("./task-BL-HVCPa.js"),[]),"../locales/en/upload.json":()=>k(()=>import("./upload-F3zO4OYV.js"),[]),"../locales/zh/common.json":()=>k(()=>import("./common-DXPfcykB.js"),[]),"../locales/zh/dashboard.json":()=>k(()=>import("./dashboard-UejX30fO.js"),[]),"../locales/zh/document.json":()=>k(()=>import("./document-B9nqrMFf.js"),[]),"../locales/zh/footer.json":()=>k(()=>import("./footer-3s_qwvWn.js"),[]),"../locales/zh/header.json":()=>k(()=>import("./header-BpiI20zM.js"),[]),"../locales/zh/index.json":()=>k(()=>import("./index-Dli2Rr2u.js"),[]),"../locales/zh/instance.json":()=>k(()=>import("./instance-BJxXJqU3.js"),[]),"../locales/zh/key.json":()=>k(()=>import("./key-BjBG3zan.js"),[]),"../locales/zh/sys.json":()=>k(()=>import("./sys-DoZMvjg8.js"),[]),"../locales/zh/task.json":()=>k(()=>import("./task-BXqCUVxI.js"),[]),"../locales/zh/upload.json":()=>k(()=>import("./upload-C65gM21-.js"),[])}),`../locales/${t}/${s}.json`,4))).use(Ut).use(Zt).init({debug:!0,fallbackLng:Ls[0],ns:Xe,fallbackNS:Xe[0],interpolation:{escapeValue:!1},detection:{order:["querystring","navigator","htmlTag"],lookupQuerystring:"lang",caches:["localStorage","cookie"],htmlTag:document.documentElement,convertDetectedLanguage:t=>/^(\w+)/.exec(t)[0]||"en"}});const zs=t=>{switch(t){case"zh":return Jt;default:return Bt}},Ps=t=>{switch(t){case"zh":return"zh-CN";default:return"en"}},As=()=>{window.location.assign(window.location.origin)},xt=({error:t})=>{const{t:s}=b("sys");return e.jsx("div",{className:"full-page justify-center items-center w-fit",children:e.jsx("div",{className:"prompt danger outline w-1/2 max-w-7xl",children:e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("p",{className:"text-2xl",children:"ðŸš¨"}),e.jsx("p",{className:"text-2xl",children:s("warning")})]}),e.jsxs("div",{className:"",children:[e.jsx("p",{children:t.message}),e.jsx("p",{className:"link inline-block",onClick:As,children:s("reload")})]})]})})})},Fs=({children:t,onReset:s,FallbackComponent:n})=>e.jsx(es,{FallbackComponent:n||xt,onReset:s,children:t}),Os=({children:t})=>e.jsx(Fs,{FallbackComponent:xt,children:t}),Ms={primary:{50:"#ffe2f1",100:"#ffb3d0",200:"#fd82af",300:"#fb518e",400:"#f8206e",500:"#df0755",600:"#ae0142",700:"#7e002f",800:"#4d001c",900:"#20000a",DEFAULT:"#f9377d"},secondary:{50:"#f2e4ff",100:"#d4b3ff",200:"#b881fd",300:"#9b4efc",400:"#7e1ffb",500:"#6608e2",600:"#4f04b0",700:"#38027e",800:"#22004d",900:"#0c001d",DEFAULT:"#21004b"}},qs={colors:Ms},Ks=({children:t})=>{const{i18n:s}=b();return e.jsx(Wt,{locale:zs(s.resolvedLanguage),children:e.jsx(ts,{theme:{colors:I.transform(I.pick(qs.colors,["primary","secondary"]),(n,i,a)=>{n||(n={}),n[a]=Object.values(i)}),primaryColor:"primary"},children:e.jsx(ss,{modalProps:{centered:!0,lockScroll:!0,shadow:"xl",radius:"lg",padding:"xl",overlayProps:{opacity:.3}},children:e.jsx(is,{children:t})})})})},Us=({children:t})=>e.jsxs(e.Fragment,{children:[t,e.jsx(cs,{richColors:!0,closeButton:!0,theme:"light",position:"bottom-right"})]}),Vs=({children:t})=>e.jsx(Os,{children:e.jsx(Ks,{children:e.jsx(Us,{children:t})})}),_e=ds({component:()=>e.jsxs(e.Fragment,{children:[e.jsx(Ve,{}),e.jsx(us,{})]}),wrapInSuspense:!0}),Bs=()=>{const{t}=b("footer");return e.jsxs("div",{className:"text-nowrap",children:[t("powered_by")+" ",e.jsx("a",{className:"hover:underline",href:"https://riccox.com",target:"_blank",rel:"noreferrer",children:"Ricco Xie"})]})};function S(...t){return vs(ct(t))}const pt=({className:t=""})=>{const{i18n:s}=b();return u.useEffect(()=>{E.locale(Ps(s.resolvedLanguage))},[s.resolvedLanguage]),e.jsx("select",{value:s.resolvedLanguage,className:S(t,"w-fit outline-none bg-transparent"),onChange:n=>{const i=n.target.value;s.changeLanguage(i)},children:I.entries(mt).map(([n,i])=>e.jsx("option",{value:n,children:i},i))})},Js="meilisearch-ui",Ws="module",Hs={dev:"vite",start:"vite",build:"vite build","build:safe":"tsc && vite build",preview:"vite preview",lint:"eslint"},Qs="https://github.com/riccox/meilisearch-ui",Ys="https://github.com/riccox/meilisearch-ui#readme",Gs="Ricco Xie <ricco@riccox.com> (https://riccox.com)",Xs={"@arco-design/web-react":"^2.64.0","@arco-themes/react-meilisearch":"^0.0.1","@douyinfe/semi-ui":"^2.67.0","@emotion/react":"^11.13.3","@hookform/resolvers":"^3.9.0","@mantine/core":"^7.13.2","@mantine/form":"^7.13.2","@mantine/hooks":"^7.13.2","@mantine/modals":"^7.13.2","@monaco-editor/react":"^4.6.0","@nextui-org/react":"^2.4.8","@radix-ui/react-slot":"^1.1.0","@semi-bot/semi-theme-meilisearch":"^0.0.2","@tabler/icons-react":"^3.19.0","@tanstack/react-query":"^5.59.8","@tanstack/react-query-devtools":"^5.59.8","@tanstack/react-router":"^1.64.0",ahooks:"^3.8.1","class-variance-authority":"^0.7.0",clsx:"^2.1.1",dayjs:"^1.11.13",echarts:"^5.5.1","echarts-for-react":"^3.0.2","framer-motion":"^11.11.7","fuse.js":"^7.0.0",i18next:"^23.15.2","i18next-browser-languagedetector":"^8.0.0","i18next-resources-to-backend":"^1.2.1",immer:"^10.1.1",lodash:"^4.17.21","lucide-react":"^0.451.0",meilisearch:"0.44.1",qs:"^6.13.0",react:"^18.3.1","react-dom":"^18.3.1","react-error-boundary":"^4.0.13","react-hook-form":"^7.53.0","react-i18next":"^15.0.2","react-json-view":"^1.21.3",sonner:"^1.5.0","tailwind-merge":"^2.5.3","tailwind-variants":"^0.2.1","tailwindcss-animate":"^1.0.7","use-immer":"^0.10.0",vaul:"^1.0.0",zod:"^3.23.8",zustand:"5.0.0-rc.2"},Zs={"@eslint/compat":"^1.2.0","@eslint/js":"^9.12.0","@iconify-json/lucide":"^1.2.8","@tanstack/router-devtools":"^1.64.0","@tanstack/router-plugin":"^1.64.0","@types/lodash":"^4.17.10","@types/node":"^22.7.5","@types/qs":"^6.9.16","@types/react":"^18.3.11","@types/react-dom":"^18.3.0","@typescript-eslint/eslint-plugin":"^8.8.1","@typescript-eslint/parser":"^8.8.1","@unocss/preset-icons":"^0.63.4","@vitejs/plugin-react-swc":"^3.7.1",autoprefixer:"^10.4.20",eslint:"9.12.0","eslint-config-react-app":"^7.0.1","eslint-plugin-react-hooks":"^4.6.2","eslint-plugin-react-refresh":"^0.4.12",globals:"^15.11.0",postcss:"^8.4.47",prettier:"^3.3.3",sass:"^1.79.4",tailwindcss:"^3.4.13",typescript:"5.6.3","typescript-eslint":"^8.8.1",unocss:"^0.63.4",vite:"^5.4.8","vite-tsconfig-paths":"^5.0.1"},en="0.9.2",tn="index.js",sn="Apache-2.0",ht={name:Js,private:!0,type:Ws,scripts:Hs,repository:Qs,homepage:Ys,author:Gs,dependencies:Xs,devDependencies:Zs,version:en,main:tn,license:sn},nn=ht.version,an=ht.dependencies.meilisearch.replace(/[^\d.]/g,""),rn=()=>{const{t}=b();return e.jsxs("span",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-nowrap",children:[t("common:version"),": ",nn,`[${"7ec60e85598cb55880a434601c288d057eeb2b52".slice(0,7)}]`]}),e.jsx(A,{content:t("footer:meilisearchVersionTip"),children:e.jsxs("span",{className:"text-nowrap",children:[t("footer:meilisearchJSInUse"),": ",an]})})]})},on=(t,s)=>G(t,s),ln=(t,s)=>G.success(t,s),cn=(t,s)=>G.error(t,s),dn=(t,s)=>G.message(t,s),un=(t,s)=>G.promise(t,{loading:s.label,success:"Success",error:"Error",...s}),mn=t=>G.dismiss(t),N=Object.assign(on,{success:ln,error:cn,info:dn,remove:mn,loading:un}),Ae="request-loader";let le=[];const Q=()=>{console.log("show loader");const t=setTimeout(()=>{const s=[...le];s.splice(s.findIndex(n=>n===t),1),le=s,N.loading(new Promise(()=>{setTimeout(()=>N.remove(Ae),5e3)}),{label:"Request loading...",success:"Request completed",error:"Request failed",id:Ae})},2e3);le.push(t)},Y=()=>{le.forEach(t=>clearTimeout(t)),le=[],N.remove(Ae)},ft="conn-test-loader",xn=()=>{N.loading(new Promise(()=>{}),{label:"Connection testing...",id:ft,duration:1/0})},Ze=()=>{N.remove(ft)},Fe=at.t,gt=async t=>{xn();const s=new Pe.MeiliSearch({...t});let n;try{n=await s.getStats(),console.debug("[meilisearch connection test]",n)}catch(i){throw console.warn("[meilisearch connection test error]",i),N.error(Fe("instance:connection_failed")),Ze(),i}if(Ze(),I.isEmpty(n)){const i=Fe("instance:connection_failed");throw N.error(i),console.error(i,n),new Error("msg")}},pn=t=>I.isEmpty(t)?{prompt:Fe("instance:no_master_key_error")}:null,hn=()=>(b("common"),e.jsx(e.Fragment,{})),ue=({className:t=""})=>e.jsxs("div",{className:S("gap-4 flex justify-center items-center w-full text-neutral-400 text-xs",t),children:[e.jsx(Bs,{}),e.jsx(rn,{}),e.jsx("a",{className:"hover:underline",href:"//github.com/riccox/meilisearch-ui",target:"_blank",rel:"noreferrer",children:"Github"}),e.jsx(pt,{}),e.jsx(hn,{})]}),me=({className:t,href:s})=>e.jsx("a",{className:S(t,"flex justify-center items-center"),href:s||"https://meilisearch.com",target:"_blank",rel:"noreferrer",children:e.jsx("img",{src:"/meili-logo.svg",className:"logo flex-1",alt:"Meili logo"})}),Ee={name:"default",host:"http://127.0.0.1:7700",apiKey:void 0},P=ws()(_s(ks((t,s)=>({instances:[],setWarningPageData:n=>t(be(i=>{i.warningPageData=n})),addInstance:n=>t(be(i=>{var a;i.instances.push({...n,updatedTime:new Date,id:(((a=I.maxBy(s().instances,"id"))==null?void 0:a.id)||0)+1})})),editInstance:(n,i)=>t(be(a=>{const r=a.instances.findIndex(l=>l.id===n);r!==-1&&(a.instances[r]={...i,id:n,updatedTime:new Date})})),removeInstance:n=>t(be(i=>{const a=i.instances.findIndex(r=>r.id===n);a!==-1&&i.instances.splice(a,1)}))}),{name:"meilisearch-ui-store",version:5})));function fn(){const{history:t}=Be(),{t:s}=b("sys"),n=P(i=>i.warningPageData);return e.jsxs("div",{className:"full-page bg-night gap-y-10 justify-center items-center",children:[e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx(me,{}),e.jsx("h1",{className:"text-4xl font-bold text-primary-100",children:s("warning")})]}),(n==null?void 0:n.prompt)&&e.jsx("p",{className:"text-primary-100 font-semibold text-base whitespace-pre-line text-balance text-center",children:n.prompt}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ze,{color:"orange",onClick:()=>window.location.assign(window.location.origin),children:s("reload")}),e.jsx(ze,{variant:"gradient",color:"blue",onClick:()=>t.back(),children:s("back")})]}),e.jsx(ue,{})]})}const gn=R("/warning")({component:fn}),jn=t=>{const s=de(),n=P(a=>a.setWarningPageData);return u.useCallback((a,r)=>{console.debug("useNavigatePreCheck",a);const l=t(a,r);l!==null?(n(l),s({to:"/warning"})):s(a??{})},[s,t,n])},D=()=>{const{t}=b("instance"),{insID:s}=lt({strict:!1}),n=P(i=>i.instances.find(a=>a.id===parseInt(s||"1")));return P(i=>i.setWarningPageData),n&&I.isEmpty(n)&&(N.error(`${t("not_found")} ðŸ¤¥`),console.debug("useCurrentInstance","Instance lost"),window.location.assign("/meiliAdmin/riccox")),n},Oe=({className:t="",children:s,type:n="create",ins:i})=>{const[a,r]=u.useState(!1),{t:l}=b("instance"),c=D(),[m]=u.useState(n),[g,v]=u.useState(!1),[x]=u.useState(i),y=P(d=>d.addInstance),p=P(d=>d.editInstance),f=P(d=>d.instances),h=dt({defaultValues:{...Ee,host:(c==null?void 0:c.host)??Ee.host,apiKey:(c==null?void 0:c.apiKey)??Ee.apiKey}}),o=u.useCallback(async d=>{v(!0);const j={...d,host:`${/^(https?:\/\/)/.test(d.host)?"":"http://"}${d.host}`};j.apiKey=I.isEmpty(j.apiKey)?void 0:j.apiKey,gt({...j}).finally(()=>{v(!1)}).then(()=>{switch(m){case"create":y({...j});break;case"edit":p(x.id,{...j});break}r(!1),h.reset()})},[m,h,y,p,x]);return e.jsxs(re.Root,{open:a,onOpenChange:d=>{h.reset(i),r(d)},children:[e.jsx(re.Trigger,{"data-state":a?"open":"closed",children:s}),e.jsxs(re.Portal,{children:[e.jsx(re.Overlay,{className:"fixed inset-0 bg-black/40"}),e.jsx(re.Content,{className:S(t,"bg-zinc-100 rounded-t-6 mt-24 fixed bottom-0 left-0 right-0 z-10"),children:e.jsxs("form",{className:"flex flex-col gap-y-6 w-full p-4 bg-white flex-1 rounded-t-6",onSubmit:h.handleSubmit(o),children:[e.jsx("div",{"bg-zinc-4":!0,"rounded-2xl":!0,"w-15":!0,"h-2":!0,"self-center":!0}),e.jsx("p",{className:"text-center font-semibold text-lg",children:l(`form.title.${m}`)}),e.jsx(K,{control:h.control,name:"name",rules:{validate:d=>{let j=[];switch(m){case"create":j=f.map(_=>_.name);break;case"edit":j=f.map(_=>_.name).filter(_=>_!==x.name);break}return j.includes(d)?(h.setError("name",{message:"Name should be different from others"}),!1):!0}},render:({field:d,fieldState:j})=>{var _,L;return e.jsx(Te,{label:l("form.name.label"),placeholder:l("form.name.placeholder"),isInvalid:!!((_=j.error)!=null&&_.message),errorMessage:(L=j.error)==null?void 0:L.message,...d})}}),e.jsx(K,{control:h.control,name:"host",rules:{validate:d=>/^(https?:\/\/)?([a-zA-Z0-9-]+((\.[a-zA-Z0-9-]+)+)?(:\d+)?)(\/[^\s]*)?$/.test(d)?!0:(h.setError("host",{message:"Host not valid"}),!1)},render:({field:d,fieldState:j})=>{var _,L;return e.jsx(e.Fragment,{children:e.jsx(se,{placement:"bottom-start",content:l("form.host.tip"),children:e.jsx(Te,{placeholder:"http://127.0.0.1:7700",label:l("form.host.label"),isInvalid:!!((_=j.error)!=null&&_.message),errorMessage:(L=j.error)==null?void 0:L.message,...d})})})}}),e.jsx(K,{control:h.control,name:"apiKey",render:({field:d,fieldState:j})=>{var _,L;return e.jsx(se,{placement:"bottom-start",content:l("form.api_key.tip"),children:e.jsx(Te,{type:"password",placeholder:"masterKey",label:l("form.api_key.label"),isInvalid:!!((_=j.error)!=null&&_.message),errorMessage:(L=j.error)==null?void 0:L.message,...d})})}}),e.jsx(w,{type:"submit",variant:"solid",size:"sm",color:"primary",disabled:g,children:l("confirm")}),e.jsx(ue,{})]})})]})]})};E.extend(bs);E.extend(Is);const yn=t=>`Task submit ${t.status}, task uid ${t.taskUid} ðŸš€`,jt={succeeded:N.success,enqueued:N.info,failed:N.error,processing:N.info,canceled:N.info},V=t=>{jt[t.status](yn(t))},Me=t=>{jt.failed(`Task Fail: ${t.toString()}`)},ke=(t,{defaultText:s="-",format:n="YYYY-MM-DD HH:mm:ss.SSS"}={})=>!t&&s?s:E(t).format(n),vn=t=>E(t).fromNow(),bn=(t,s)=>E.duration(t).get(s).toPrecision(5).toString(),In=t=>JSON.stringify(t,void 0,2);function et(t){return E(t).isValid()?/^\d+$/g.test(t)&&t.length<13?E.unix(parseInt(t)).toDate():E(t).toDate():!1}function tt(t){try{const s=new URL(t);return(s.protocol==="http:"||s.protocol==="https:")&&/\.(jpg|jpeg|png|gif|webp)$/.test(s.pathname)}catch{return!1}}const O=({className:t="",date:s})=>{const[n,i]=u.useState(!1);return e.jsx("div",{className:S("w-fit h-fit",t),onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},children:s&&E(s).isValid()?n?ke(s):vn(s):"-"})},st="col-span-1 h-28 rounded-lg";function wn(){const{t}=b("dashboard"),s=jn((c,m)=>{var g;return console.debug("dashboard","navigate",c.to,m==null?void 0:m.currentInstance),typeof c.to=="string"&&/\/keys$/.test(c.to)?pn((g=m==null?void 0:m.currentInstance)==null?void 0:g.apiKey):null}),n=P(c=>c.removeInstance),i=P(c=>c.instances),a=u.useCallback((c,m)=>{gt({...c}).then(()=>{m&&s({to:m},{currentInstance:c})})},[s]),r=u.useCallback(c=>{const m="removeInsModal";Re.open({modalId:m,title:t("instance.remove.title"),centered:!0,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("p",{children:[t("instance.remove.tip")," (",c.name,")?"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ce,{block:!0,theme:"solid",type:"danger",onClick:()=>{n(c.id),Re.close(m)},children:t("confirm")}),e.jsx(ce,{block:!0,theme:"solid",type:"secondary",onClick:()=>{Re.close(m)},children:t("cancel")})]})]})})},[n,t]),l=u.useMemo(()=>i.map((c,m)=>e.jsxs("div",{className:`bg-white flex flex-col justify-between py-4 px-6 group
      hover:ring-primary-100 hover:ring-2 ${st}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-2xl font-bold group-hover:underline cursor-pointer",onClick:()=>a(c,`/ins/${c.id}`),children:c.name}),e.jsxs("p",{className:"text-2xl font-bold cursor-pointer text-bw-800/50",onClick:()=>a(c,`/ins/${c.id}`),children:["#",c.id]})]}),e.jsxs("div",{className:"flex gap-x-3",children:[e.jsx(Oe,{ins:c,type:"edit",children:e.jsx(ye,{position:"left",label:t("edit"),children:e.jsx(Z,{variant:"light",color:"yellow",children:e.jsx(Ct,{size:24})})})}),e.jsx(Z,{variant:"light",onClick:()=>r(c),children:e.jsx(St,{size:24})})]})]}),e.jsxs("div",{className:"w-full flex justify-end items-center gap-x-3",children:[e.jsxs("p",{className:"mr-auto text-neutral-500 text-sm inline-flex gap-1",children:[t("instance.updated_at")," ",e.jsx(O,{date:c.updatedTime})]}),e.jsx(ye,{position:"bottom",label:t("indexes"),children:e.jsx(Z,{variant:"light",color:"violet",onClick:()=>a(c,`/ins/${c.id}`),children:e.jsx(Rt,{size:24})})}),e.jsx(ye,{position:"bottom",label:t("tasks"),children:e.jsx(Z,{variant:"light",color:"blue",onClick:()=>a(c,`/ins/${c.id}/tasks`),children:e.jsx(Tt,{size:24})})}),e.jsx(ye,{position:"bottom",label:t("keys"),children:e.jsx(Z,{variant:"light",color:"grape",onClick:()=>a(c,`/ins/${c.id}/keys`),children:e.jsx($t,{size:24})})})]})]},m)),[i,a,r,t]);return e.jsxs("div",{className:"bg-mount full-page justify-center items-center gap-y-6",children:[e.jsxs("div",{className:"w-1/2 2xl:w-1/4 h-2/3 flex flex-col justify-center items-center gap-y-10",children:[e.jsx(me,{className:"size-20"}),e.jsx("p",{className:"text-primary-100 font-bold xl:text-3xl text-xl w-screen text-center",children:t("slogan")}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-3 w-full p-1  overflow-y-scroll",children:[l,e.jsx(Oe,{type:"create",children:e.jsx("div",{className:`${st}
              flex justify-center items-center 
              hover:cursor-pointer hover:opacity-80 hover:border-neutral-200 hover:border-2 
              bg-neutral-500 bg-opacity-30 border border-neutral-500 border-dashed`,children:e.jsx(Et,{color:"white",opacity:.5,size:48})})})]})]}),e.jsx(ue,{className:"!text-white"})]})}const _n=R("/")({component:wn,beforeLoad:async()=>{}}),kn=()=>{const t=ms(),{t:s}=b(),n=t({to:"/ins/$insID",fuzzy:!0}),i=t({to:"/ins/$insID/keys",fuzzy:!0}),a=t({to:"/ins/$insID/tasks",fuzzy:!0}),r=t({to:"/ins/$insID/index/$indexUID",fuzzy:!0}),l=t({to:"/ins/$insID/index/$indexUID/documents",fuzzy:!0}),c=t({to:"/ins/$insID/index/$indexUID/documents/upload",fuzzy:!0}),m=t({to:"/ins/$insID/index/$indexUID/setting",fuzzy:!0}),g=P(v=>v.instances.find(x=>x.id===parseInt(n.insID)));return e.jsxs(as,{color:"primary",variant:"light",children:[e.jsx(B,{href:"/meiliAdmin/riccox",children:"ðŸ "}),n&&e.jsx(B,{href:`/ins/${n.insID}`,children:`#${n.insID} ${s("common:instance")} ${g==null?void 0:g.name}`}),i&&e.jsx(B,{href:`/ins/${n.insID}/keys`,children:`${s("common:keys")}`}),a&&e.jsx(B,{href:`/ins/${n.insID}/tasks`,children:`${s("common:tasks")}`}),r&&e.jsx(B,{href:`/ins/${n.insID}/index/${r.indexUID}`,children:`${s("common:indexes")}: ${r.indexUID}`}),l&&e.jsx(B,{href:`/ins/${n.insID}/index/${r.indexUID}/documents`,children:`${s("documents")}`}),c&&e.jsx(B,{href:`/ins/${n.insID}/index/${r.indexUID}/documents/upload`,children:`${s("upload:title")}`}),m&&e.jsx(B,{href:`/ins/${n.insID}/index/${r.indexUID}/setting`,children:`${s("settings")}`})]})},Nn=()=>{const{t}=b("header");return e.jsxs("header",{className:"px-4 py-2 bg-white border-b border-neutral-600/20 overflow-hidden flex items-center gap-4 flex-shrink-0 flex-grow-0 basis-auto",children:[e.jsx(me,{className:"size-8"}),e.jsx(kn,{}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx($e,{href:"https://docs.meilisearch.com",target:"_blank",className:"!inline-flex items-center !no-underline",icon:e.jsx(Lt,{size:"1.5em"}),children:t("meilisearch_docs")}),e.jsx($e,{href:"https://github.com/riccox/meilisearch-ui/issues",target:"_blank",className:"!inline-flex items-center !no-underline",icon:e.jsx(zt,{size:"1.5em"}),children:t("issues")}),e.jsx($e,{href:"https://github.com/riccox/meilisearch-ui",target:"_blank",className:"!inline-flex items-center !no-underline",icon:e.jsx(Pt,{size:"1.5em"}),children:t("open_source")}),e.jsx(pt,{className:"text-small font-semibold"})]})]})},Dn="_loader_ekbha_2",Cn="_l13_ekbha_1",Sn={loader:Dn,l13:Cn},Ne=({className:t})=>e.jsxs("div",{className:S(Sn.loader,t,""),children:[e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{})]}),J=({className:t,loaderCls:s})=>e.jsx("div",{className:S(t,"w-full h-full flex-1 flex justify-center items-center"),children:e.jsx(Ne,{className:s})});function Rn(){return e.jsxs("div",{className:"full-page",children:[e.jsx(Nn,{}),e.jsx(Ve,{})]})}const Tn=R("/ins/$insID/_layout")({component:Rn,pendingComponent:J}),C=()=>{const{t}=b("instance"),s=D(),[n,i]=u.useState(new Pe.MeiliSearch({...s})),a=P(l=>l.setWarningPageData),r=u.useCallback(async()=>{if(I.isEmpty(s==null?void 0:s.host)){N.error(t("connection_failed")),console.debug("useMeilisearchClient","connection config lost"),window.location.assign("/meiliAdmin/riccox");return}const l=new Pe.MeiliSearch({...s});try{await l.getStats(),i(l)}catch(c){console.warn("useMeilisearchClient","test conn error",c),N.error(t("connection_failed")),window.location.assign("/meiliAdmin/riccox")}},[s,a,t]);return u.useEffect(()=>{console.debug("useMeilisearchClient","rebuilt meili client"),r().then()},[r,s]),n},We=t=>{const s=D(),n=s==null?void 0:s.host,[i,a]=u.useState(),r=M({queryKey:["stats",n],queryFn:async()=>({...await t.getStats(),version:await t.getVersion()})});return u.useEffect(()=>{r.isSuccess&&a(r.data),r.isError&&console.warn("get meilisearch stats error",r.error)},[r.data,r.error,r.isError,r.isSuccess]),i},De=({className:t="",children:s})=>{const{t:n}=b();return e.jsx(Ht.Paragraph,{className:t,copyable:{onCopy:()=>G.success(n("common:copied")),icon:e.jsx(Ue,{size:"0.95em",className:" text-current"}),copyTip:n("common:copy"),successTip:"âœ…"},children:s})},$n=t=>{const s=D(),[n,i]=u.useState(!0),a=M({queryKey:["health",s==null?void 0:s.host],queryFn:async()=>(await t.health()).status==="available",refetchInterval:3e4});return u.useEffect(()=>{a.isSuccess&&i(a.data)},[a.data,a.isSuccess]),n},En=({afterMutation:t})=>{const{t:s}=b("instance"),n=C(),i=we({initialValues:{uid:"",primaryKey:void 0},validate:{uid:g=>/[\da-zA-Z-_]+/.test(g)?null:s("create_index.form.uid.validation_error")}}),[a,r]=u.useState(!1),l=()=>{r(!0)},c=()=>{r(!1),i.reset()},m=u.useCallback(async g=>{let v;try{v=await n.createIndex(g.uid,{primaryKey:g.primaryKey}),console.info(v),I.isEmpty(v)||(V(v),t())}catch(x){console.warn(x),N.error(s("toast.fail",{msg:x}))}},[t,n,i,s]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",color:"primary",onClick:()=>{l()},children:s("common:create")}),e.jsx($,{centered:!0,footerFill:!0,visible:a,title:s("create_index.label"),okText:s("create_index.label"),cancelText:s("common:cancel"),afterClose:()=>{c()},onOk:async()=>{await m(i.values),c()},onCancel:c,children:e.jsxs("form",{className:"pt-3 space-y-3",children:[e.jsx(A,{position:"bottomLeft",content:s("create_index.form.uid.tip"),children:e.jsx(te,{autoFocus:!0,addonBefore:"UID",placeholder:s("create_index.form.uid.placeholder"),required:!0,...i.getInputProps("uid")})}),e.jsx(A,{position:"bottomLeft",content:s("create_index.form.primaryKey.tip"),children:e.jsx(te,{addonBefore:s("create_index.form.primaryKey.label"),placeholder:s("create_index.form.primaryKey.placeholder"),...i.getInputProps("primaryKey")})})]})})]})},Ln="/meiliAdmin/riccox/assets/undraw_web_search-wfp_0yX1.svg",yt=({text:t})=>{const{t:s}=b();return e.jsxs("div",{className:"fill flex flex-col gap-4 justify-center items-center",children:[e.jsx("img",{className:"w-1/4",src:Ln,alt:"undraw_web_search"}),e.jsx("p",{className:"font-extrabold text-xl",children:t??s("common:empty")})]})},nt=new Rs([],{keys:["uid","primaryKey"],includeMatches:!1,includeScore:!0,shouldSort:!0}),zn=({className:t="",client:s})=>{var p,f;const n=de(),{t:i}=b("index"),a=D(),r=a==null?void 0:a.host,l=We(s),[c,m]=Ss({offset:0,limit:24,query:""}),g=M({queryKey:["indexList",r,c],queryFn:async()=>{const h=await s.getIndexes(I.pick(c,["offset","limit"]));return nt.setCollection(h.results||[]),h},placeholderData:xs}),v=u.useMemo(()=>{var h;return c.query&&c.query.trim().length>0?nt.search(c.query).map(o=>o.item)||[]:((h=g.data)==null?void 0:h.results)||[]},[(p=g.data)==null?void 0:p.results,c.query]),x=u.useMemo(()=>v.map(h=>{const o=h.uid,d=l==null?void 0:l.indexes[h.uid];return{uid:o,numberOfDocuments:(d==null?void 0:d.numberOfDocuments)||0,href:`/ins/${a.id}/index/${o}`,isIndexing:d==null?void 0:d.isIndexing,createdAt:h.createdAt,updatedAt:h.updatedAt,primaryKey:h.primaryKey}}),[a.id,v,l==null?void 0:l.indexes]),y=u.useMemo(()=>{var h;return{currentPage:c.offset/c.limit+1,totalPage:I.ceil((((h=g.data)==null?void 0:h.total)||0)/c.limit)}},[(f=g.data)==null?void 0:f.total,c.limit,c.offset]);return u.useMemo(()=>{var h;return e.jsxs("div",{className:S("flex flex-col gap-y-2 flex-1",t),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-2xl font-bold text-nowrap",children:i("common:indexes")}),e.jsx(A,{content:i("search.tip"),children:e.jsx("div",{className:"ml-auto !w-60",children:e.jsx(Ns.Search,{placeholder:i("common:search"),defaultValue:"",onChange:o=>m(d=>{d.query=o})})})}),e.jsx(En,{afterMutation:()=>g.refetch()})]}),x&&x.length>0?e.jsx("div",{className:"grid grid-cols-6 gap-5 place-content-start place-items-start py-3",children:x==null?void 0:x.map(o=>e.jsxs(rs,{fullWidth:!0,shadow:"sm",className:"col-span-3 laptop:col-span-2 hover:no-underline h-fit hover:outline-primary-400/80 outline outline-2 outline-transparent",children:[e.jsx(os,{as:U,to:o.href,children:e.jsx("div",{className:"text-xl px-1",children:o.uid})}),e.jsxs(ls,{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-neutral-500 text-xs px-1",children:[o.createdAt&&e.jsxs("p",{className:"inline-flex gap-1",children:[i("common:created_at")," ",e.jsx(O,{date:o.createdAt})]}),o.updatedAt&&e.jsxs("p",{className:"inline-flex gap-1",children:[i("common:updated_at")," ",e.jsx(O,{date:o.updatedAt})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{size:"small",color:"cyan",className:"mr-auto",children:[i("count"),": ",o.numberOfDocuments??0]}),o.isIndexing&&e.jsx(A,{content:i("indexing_tip"),children:e.jsxs(F,{color:"amber",size:"small",className:"flex flex-nowrap",children:[e.jsx(At,{size:"1em"}),e.jsxs("div",{children:[i("indexing"),"..."]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{content:i("settings"),children:e.jsx(ce,{theme:"light",type:"warning",icon:e.jsx("div",{className:"i-lucide:settings w-1em h-1em"}),size:"small",onClick:()=>n({to:`index/${o.uid}/setting`,from:"/ins/$insID"})})}),e.jsx(A,{content:i("tasks"),children:e.jsx(ce,{theme:"light",type:"primary",icon:e.jsx("div",{className:"i-lucide:workflow w-1em h-1em"}),size:"small",onClick:()=>n({to:"tasks",search:{indexUids:[o.uid]},from:"/ins/$insID"})})})]})]})]})]},o.uid))}):e.jsx(yt,{}),e.jsx("div",{className:"flex justify-center",children:e.jsx(rt,{pageSize:c.limit,total:(h=g.data)==null?void 0:h.total,currentPage:y.currentPage,onPageChange:o=>{m(d=>{d.offset=(o-1)*c.limit}),g.refetch()}})})]})},[t,x,n,y.currentPage,g,c.limit,i,m])},vt=({className:t="",children:s})=>e.jsxs("div",{className:S(t,"w-fit text-3xl font-bold relative z-10 text-ellipsis text-nowrap"),title:s,children:[I.truncate(s,{length:20}),e.jsx("div",{className:"-z-10 absolute w-full h-[0.8rem] bg-primary-400/75 -bottom-[2px] rounded-lg"})]}),Pn=()=>{const{t}=b("instance"),s=D(),n=C(),i=u.useCallback(()=>{$.confirm({title:t("instance:dump.dialog.title"),centered:!0,content:e.jsx("p",{children:t("instance:dump.dialog.tip",{name:s.name})}),onOk:async()=>{V(await n.createDump())},okText:t("confirm"),cancelText:t("cancel")})},[n,s.name,t]);return e.jsxs(w,{onClick:i,color:"default",variant:"light",size:"sm",children:[e.jsx("div",{className:"i-lucide:archive-restore w-1em h-1em"}),"Dump"]})};function An(){const{t}=b("instance"),s=D(),n=C(),i=We(n),a=$n(n),r=u.useMemo(()=>[{key:t("host"),value:e.jsx(De,{children:s.host})},{key:t("common:updated_at"),value:e.jsx(O,{date:s.updatedTime})},{key:t("db_size"),value:e.jsx(je,{placeholder:e.jsx(je.Title,{}),active:!0,loading:!(i!=null&&i.databaseSize),children:`${I.ceil(((i==null?void 0:i.databaseSize)??0)/1048576,2)} MB`})},{key:t("status.label"),value:a?e.jsx(F,{color:"green",children:t("status.available")}):e.jsx(F,{color:"amber",children:t("unknown")})},{key:t("version.label"),value:e.jsx(je,{placeholder:e.jsx(je.Title,{}),active:!0,loading:!(i!=null&&i.version),children:e.jsx(F,{children:i==null?void 0:i.version.pkgVersion})})}],[s.host,s.updatedTime,a,i==null?void 0:i.databaseSize,i==null?void 0:i.version,t]);return e.jsxs("div",{className:"flex-1 grid grid-cols-4 overflow-scroll",children:[e.jsxs("main",{className:"p-4 laptop:col-start-2 laptop:col-end-4 col-start-1 col-end-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 items-baseline",children:[e.jsx(vt,{children:`#${s.id} ${s.name}`}),e.jsx(Oe,{ins:s,type:"edit",children:e.jsx(oe,{content:t("edit"),position:"right",mini:!0,children:e.jsx("div",{className:"i-lucide:edit w-1em h-1em cursor-pointer hover:scale-90 transition"})})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(H,{className:"flex-1",align:"left",data:r}),e.jsxs("div",{className:"flex flex-col gap-3 items-start",children:[e.jsx(U,{to:"keys",from:"/ins/$insID",children:e.jsxs(w,{variant:"light",size:"sm",children:[e.jsx("div",{className:"i-lucide:key w-1em h-1em"})," ",t("keys")]})}),e.jsx(U,{to:"tasks",from:"/ins/$insID",children:e.jsxs(w,{variant:"light",size:"sm",children:[e.jsx("div",{className:"i-lucide:workflow w-1em h-1em"}),t("tasks")]})}),e.jsx(Pn,{})]})]}),e.jsx(zn,{client:n})]}),e.jsx(ue,{className:"col-span-full mt-auto mb-3"})]})}const Fn=R("/ins/$insID/_layout/")({component:An,pendingComponent:J}),On=T.object({indexUids:T.string().array().optional(),limit:T.number().positive().optional(),from:T.number().nonnegative().optional(),statuses:T.string().array().optional(),types:T.string().array().optional()}),Mn=()=>{var v;const t=de({from:qe.fullPath}),s=qe.useSearch(),{t:n}=b("task"),i=C(),a=D(),r=a==null?void 0:a.host,[l,c]=u.useReducer((x,y)=>({...x,...y}),{...s});u.useEffect(()=>{t({search:()=>({...l})})},[t,l]);const m=M({queryKey:["tasks",r,l],queryFn:async()=>(Q(),console.debug("getTasks",i.config,l),await i.getTasks({...I.omitBy(l,I.isEmpty)}))});u.useEffect(()=>{m.isError&&console.warn("get meilisearch tasks error",m.error),m.isFetching||Y()},[m.error,m.isError,m.isFetching]);const g=[{title:"UID",dataIndex:"uid",width:100},{title:n("indexes"),dataIndex:"indexUid",render:x=>x?e.jsx(U,{to:`/ins/${a.id}/index/${x}`,children:x}):"-"},{title:n("common:type"),dataIndex:"type",render:x=>n(`type.${x}`)},{title:n("common:status"),dataIndex:"status",width:120,render:x=>n(`status.${x}`)},{title:n("duration"),dataIndex:"duration",width:200,render:(x,y)=>`${bn(y.duration,"millisecond")}ms`},{title:n("enqueued_at"),dataIndex:"enqueuedAt",width:220,render:(x,y)=>e.jsx(O,{date:y.enqueuedAt})},{title:n("started_at"),dataIndex:"startedAt",width:220,render:(x,y)=>e.jsx(O,{date:y.startedAt})},{title:n("finished_at"),dataIndex:"finishedAt",width:220,render:(x,y)=>e.jsx(O,{date:y.finishedAt})},{title:n("actions"),fixed:"right",width:150,render:(x,y)=>e.jsx("div",{className:"flex justify-center items-center gap-2",children:e.jsx(w,{size:"sm",onClick:()=>{$.info({title:n("common:detail"),centered:!0,footer:null,content:e.jsx("div",{className:"flex justify-center items-center p-4 pb-6",children:e.jsx(ut,{name:!1,displayDataTypes:!1,displayObjectSize:!1,enableClipboard:!1,src:y,collapsed:3,collapseStringsAfterLength:50})})})},variant:"flat",children:n("common:detail")})})}];return e.jsx("div",{className:"flex-1 overflow-scroll max-h-fit",children:e.jsxs("main",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx(Qt,{className:"flex-1",placeholder:n("filter.index.placeholder"),value:l.indexUids,onChange:x=>{c({indexUids:x})}}),e.jsx(ee,{placeholder:n("filter.type.placeholder"),optionList:I.entries(n("type",{returnObjects:!0})).map(([x,y])=>({value:x,label:y})),multiple:!0,value:l.types,onChange:x=>{c({types:x||void 0})}}),e.jsx(ee,{placeholder:n("filter.status.placeholder"),optionList:I.entries(n("status",{returnObjects:!0})).map(([x,y])=>({value:x,label:y})),multiple:!0,value:l.statuses,onChange:x=>{c({statuses:x||void 0})}})]}),e.jsx(ot,{columns:g,dataSource:(v=m.data)==null?void 0:v.results,pagination:!1,empty:n("empty")})]})})},qe=R("/ins/$insID/_layout/tasks")({component:Mn,pendingComponent:J,validateSearch:On}),qn=(t,s)=>{const n=D(),i=n==null?void 0:n.host,[a,r]=u.useState([]),l=M({queryKey:["indexes",i],queryFn:async()=>(await t.getIndexes(s)).results});return u.useEffect(()=>{l.isSuccess&&r(l.data)},[l.data,l.isSuccess]),[a,l]},Kn=({className:t="",type:s="create",data:n,afterSubmit:i})=>{const{t:a}=b("key"),r=C(),[l]=u.useState(s),[c,m]=u.useState(!1),[g]=u.useState(n),[v]=qn(r,{limit:1e4}),x=dt({defaultValues:s==="edit"?g:{}}),y=u.useCallback(async p=>{switch(m(!0),l){case"create":await r.createKey({...p,indexes:I.isEmpty(p.indexes)?["*"]:p.indexes,actions:I.isEmpty(p.actions)?["*"]:p.actions,expiresAt:I.isEmpty(p.expiresAt)?null:ke(p.expiresAt,{format:"YYYY-MM-DD HH:mm:ss+00:00"})});break;case"edit":await r.updateKey(g.uid,{...p});break}m(!1),i()},[l,i,r,g]);return e.jsxs("form",{className:S(t,"flex flex-col gap-y-6 w-full p-4 bg-white flex-1 rounded-t-6"),onSubmit:x.handleSubmit(y),children:[e.jsx("p",{className:"text-center font-semibold text-lg",children:a(`form.title.${l}`)}),e.jsx(K,{control:x.control,name:"uid",rules:{required:!1},render:({field:p})=>e.jsxs("label",{children:["UID",e.jsx(te,{disabled:l==="edit",placeholder:a("form.uid.placeholder"),value:p.value,onChange:f=>p.onChange(f)})]})}),e.jsx(K,{control:x.control,name:"name",rules:{required:!0},render:({field:p})=>e.jsxs("label",{children:[a("name"),e.jsx(te,{placeholder:a("form.name.placeholder"),value:p.value,onChange:f=>p.onChange(f)})]})}),e.jsx(K,{control:x.control,name:"description",rules:{required:!0},render:({field:p})=>e.jsxs("label",{children:[a("description"),e.jsx(te,{placeholder:a("form.description.placeholder"),value:p.value,onChange:f=>p.onChange(f)})]})}),e.jsx(se,{placement:"bottom-start",content:a("form.indexes.tip"),children:e.jsx(K,{control:x.control,name:"indexes",rules:{required:!0},render:({field:p})=>e.jsxs("label",{children:[a("props.indexes"),e.jsx(ee,{disabled:l==="edit",className:"w-full",multiple:!0,defaultValue:[],value:p.value,onChange:f=>p.onChange(f),placeholder:a("form.indexes.placeholder"),children:v.map(f=>e.jsx(ee.Option,{value:f.uid,children:f.uid},f.uid))})]})})}),e.jsx(se,{placement:"bottom-start",content:a("form.actions.tip"),children:e.jsx(K,{control:x.control,name:"actions",rules:{required:!0},render:({field:p})=>e.jsxs("label",{children:[a("props.actions"),e.jsx(ee,{disabled:l==="edit",className:"w-full",multiple:!0,defaultValue:[],value:p.value,onChange:f=>p.onChange(f),placeholder:a("form.actions.placeholder"),children:[{value:"search",label:"search"},{value:"documents.add",label:"documents.add"},{value:"documents.get",label:"documents.get"},{value:"documents.delete",label:"documents.delete"},{value:"indexes.create",label:"indexes.create"},{value:"indexes.get",label:"indexes.get"},{value:"indexes.update",label:"indexes.update"},{value:"indexes.delete",label:"indexes.delete"},{value:"tasks.get",label:"tasks.get"},{value:"settings.get",label:"settings.get"},{value:"settings.update",label:"settings.update"},{value:"stats.get",label:"stats.get"},{value:"dumps.create",label:"dumps.create"},{value:"version",label:"version"},{value:"keys.get",label:"keys.get"},{value:"keys.create",label:"keys.create"},{value:"keys.update",label:"keys.update"},{value:"keys.delete",label:"keys.delete"}].map(f=>e.jsx(ee.Option,{value:f.value,children:f.label},f.value))})]})})}),e.jsx(se,{placement:"bottom-start",content:a("form.expiresAt.tip"),children:e.jsx(K,{control:x.control,name:"expiresAt",rules:{validate:p=>p&&E(p).isValid()?!0:(x.setError("expiresAt",{message:a("form.expireAt.invalid")}),!1)},render:({field:p})=>e.jsxs("label",{children:[a("expired_at"),e.jsx(Yt,{disabled:l==="edit",className:"w-full",position:"top",zIndex:5e3,value:p.value??E().toDate(),onChange:(f,h)=>{console.log(f,h),x.setValue("expiresAt",f)},type:"dateTime"})]})})}),e.jsx(w,{type:"submit",variant:"solid",size:"sm",color:"primary",disabled:c,children:a("common:submit")})]})},Un=()=>{var y,p;const{t}=b("key"),s=C(),n=D(),i=n==null?void 0:n.host,[a,r]=u.useReducer((f,h)=>({...f,...h}),{visible:!1,type:"create"}),[l,c]=u.useReducer((f,h)=>({...f,...h}),{pageSize:20,currentPage:1}),m=M({queryKey:["keys",i,l],queryFn:async()=>(Q(),console.debug(s.config,l),await s.getKeys({limit:l.pageSize,offset:(l.currentPage-1)*l.pageSize}))});u.useEffect(()=>{m.isError&&console.warn("get meilisearch keys error",m.error),m.isFetching||Y()},[m.error,m.isError,m.isFetching]);const g=u.useCallback(()=>{setTimeout(()=>{m.refetch().then()},1e3)},[m]),v=u.useCallback(f=>{$.confirm({title:t("delete.title"),centered:!0,content:e.jsx("p",{children:t("delete.tip")}),onOk:async()=>{s.deleteKey(f.uid).finally(()=>{g()})},okText:t("confirm"),cancelText:t("cancel")})},[s,g,t]),x=[{title:t("name"),dataIndex:"name",width:200},{title:t("props.key"),dataIndex:"key",width:120,render:f=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{children:f.replace(/^(.{8})(?:\S+)(.{6})$/,"$1****$2")}),e.jsx(ns,{value:f,timeout:200,children:({copied:h,copy:o})=>e.jsx(se,{content:t(h?"copied":"copy"),placement:"right",children:e.jsx(Z,{color:h?"teal":"gray",variant:"transparent",onClick:o,children:h?e.jsx(Ft,{size:16}):e.jsx(Ue,{size:16})})})})]})},{title:t("props.indexes"),dataIndex:"indexes",width:170,render:(f,h)=>e.jsx(Qe,{maxTagCount:3,tagList:h.indexes.map(o=>({children:o})),showPopover:!0})},{title:t("props.actions"),dataIndex:"actions",width:180,render:(f,h)=>e.jsx(Qe,{maxTagCount:3,tagList:h.actions.map(o=>({children:o})),showPopover:!0})},{title:t("expired_at"),dataIndex:"expiresAt",width:200,render:(f,h)=>ke(h.expiresAt,{defaultText:t("forever")})},{title:t("actions"),dataIndex:"operate",render:(f,h)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:"sm",onClick:()=>{$.info({title:t("common:detail"),centered:!0,footer:null,content:e.jsxs(H,{className:"pb-3",children:[e.jsx(H.Item,{itemKey:"UID",children:h.uid}),e.jsx(H.Item,{itemKey:t("description"),children:h.description}),e.jsx(H.Item,{itemKey:t("created_at"),children:e.jsx(O,{date:h.createdAt})}),e.jsx(H.Item,{itemKey:t("updated_at"),children:e.jsx(O,{date:h.updatedAt})})]})})},variant:"flat",children:t("common:detail")}),e.jsx(w,{size:"sm",variant:"flat",onClick:()=>{r({visible:!0,type:"edit",editing:h})},children:t("common:edit")}),e.jsx(w,{color:"warning",size:"sm",onClick:()=>{v(h)},variant:"flat",children:t("common:delete")})]})}];return e.jsx("div",{className:"flex-1 overflow-scroll max-h-fit",children:e.jsxs("main",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsx(w,{variant:"solid",color:"primary",size:"sm",onClick:()=>{r({visible:!0,type:"create"})},children:t("common:create")}),e.jsx(rt,{size:"small",pageSize:l.pageSize,total:(y=m.data)==null?void 0:y.total,currentPage:l.currentPage,onPageChange:f=>{c({currentPage:f}),m.refetch()}})]}),e.jsx(ot,{columns:x,dataSource:(p=m.data)==null?void 0:p.results,pagination:!1,empty:t("empty")}),e.jsx($,{visible:a.visible,onCancel:()=>{r({visible:!1})},closable:!1,footer:!1,children:e.jsx(Kn,{afterSubmit:()=>{g(),r({visible:!1})},data:a.editing?{...a.editing,name:a.editing.name??""}:void 0,type:a.type})})]})})},Vn=R("/ins/$insID/_layout/keys")({component:Un,pendingComponent:J}),X=t=>{const{history:s}=Be(),{t:n,i18n:i}=b("index"),{indexUID:a,insID:r}=lt({strict:!1}),l=ps({queryKey:["index",r,a],queryFn:async()=>(console.debug("getting current index",t.config),await t.getIndex(a))}),c=u.useMemo(()=>l.isFetched&&!I.isEmpty(l.data),[l.data,l.isFetched]);return u.useEffect(()=>{l.isFetched&&I.isEmpty(l.data)&&(console.debug("useCurrentIndex","lost index",l.data),N.error(`${n("not_found")} ðŸ¤¥`),s.back())},[s,l.data,l.isFetched,i.resolvedLanguage,n]),{index:l.data,ready:c,query:l}},Bn=({afterMutation:t})=>{const{t:s}=b("index"),n=C(),i=X(n),a=we({initialValues:{primaryKey:i.index.primaryKey}}),[r,l]=u.useState(!1),c=()=>{l(!0)},m=()=>{l(!1),a.reset()},g=u.useCallback(async v=>{let x;try{x=await i.index.update({primaryKey:v.primaryKey}),console.info(x),I.isEmpty(x)||(V(x),t())}catch(y){console.warn(y),N.error(s("toast.fail",{msg:y}))}},[t,i.index,a,s]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-1 items-center",children:[i.index.primaryKey?e.jsx(De,{children:i.index.primaryKey}):s("common:none"),e.jsx("div",{className:"i-lucide:edit w-1em h-1em cursor-pointer hover:scale-90 transition",onClick:()=>{c()}})]}),e.jsx($,{centered:!0,footerFill:!0,visible:r,title:s("update")+s("primaryKey"),okText:s("submit"),cancelText:s("common:cancel"),afterClose:()=>{m()},onOk:async()=>{await g(a.values),m()},onCancel:m,children:e.jsx("form",{className:"pt-3 space-y-3",children:e.jsx(A,{position:"bottomLeft",content:s("create_index.form.primaryKey.tip"),children:e.jsx(te,{addonBefore:s("primaryKey"),...a.getInputProps("primaryKey")})})})})]})},Le=({value:t,label:s})=>e.jsxs("div",{className:"px-2 text-xs font-400",children:[e.jsx("p",{className:"text-sm font-600",children:s}),t]});function Jn(){const{t}=b("index"),s=C(),n=X(s);return console.debug("index dash page building",n),u.useMemo(()=>{var i,a,r;return e.jsxs("div",{className:"flex-1 grid grid-cols-5 laptop:grid-cols-7 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex flex-col gap-4 border-r overflow-hidden",children:[e.jsx(vt,{className:"scale-95",children:`${(i=n.index)==null?void 0:i.uid}`}),e.jsx(Le,{label:"UID",value:e.jsx(De,{children:((a=n.index)==null?void 0:a.uid)||""})}),e.jsx(Le,{label:t("common:updated_at"),value:e.jsx(O,{date:(r=n.index)==null?void 0:r.updatedAt})}),n.index&&e.jsx(Le,{label:t("primaryKey"),value:e.jsx(Bn,{afterMutation:()=>{window.location.reload()}})}),e.jsxs("div",{className:"flex flex-col gap-3 items-stretch",children:[e.jsx(U,{to:"",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:square-kanban w-1em h-1em"}),e.jsx("div",{children:t("dashboard")})]})})}),e.jsx(U,{to:"documents",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:book-text w-1em h-1em"}),e.jsx("div",{children:t("documents")})]})})}),e.jsx(U,{to:"../../tasks",search:{indexUids:[n.index.uid]},from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:workflow w-1em h-1em"}),e.jsx("div",{children:t("tasks")})]})})}),e.jsx(U,{to:"setting",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:settings w-1em h-1em"}),e.jsx("div",{children:t("settings")})]})})}),e.jsx(U,{to:"documents/upload",from:"/ins/$insID/index/$indexUID",children:e.jsx(w,{fullWidth:!0,variant:"light",size:"sm",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-2",children:[e.jsx("div",{className:"i-lucide:upload w-1em h-1em"}),e.jsx("div",{children:t("document:upload_documents")})]})})})]})]}),e.jsx("div",{className:"col-start-2 -col-end-1 overflow-hidden",children:e.jsx(Ve,{})})]})},[n.index,t])}const Wn=R("/ins/$insID/_layout/index/$indexUID/_layout")({component:Jn,pendingComponent:J}),Hn=()=>{const{t}=b("index"),s=C(),n=X(s),i=We(s),a=(i==null?void 0:i.indexes[n.index.uid].fieldDistribution)??{};return e.jsx("div",{className:"grid grid-cols-6 h-full overflow-scroll",children:e.jsxs("main",{className:"p-4 laptop:col-start-2 laptop:-col-end-2 col-start-1 -col-end-1 flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col gap-4 px-1",children:e.jsx(Ds,{title:e.jsx("div",{className:"text-1rem text-black font-bold",children:t("count")}),value:i==null?void 0:i.indexes[n.index.uid].numberOfDocuments,countUp:!0,loading:!(i!=null&&i.indexes[n.index.uid]),styleValue:{color:"green"},groupSeparator:!0})}),e.jsx(Ts,{option:{title:{text:`${t("fieldDistribution.label")} (${t("fieldDistribution.tip")})`,textStyle:{fontSize:"1rem",color:"black"},subtext:t("fieldDistribution.subtitle"),sublink:"https://www.meilisearch.com/docs/reference/api/stats"},legend:{top:"50%",left:"right",orient:"vertical"},tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},toolbox:{show:!0,feature:{mark:{show:!0},saveAsImage:{show:!0}}},series:[{type:"pie",radius:[50,250],center:["50%","50%"],roseType:"area",itemStyle:{normal:{borderRadius:8,label:{show:!0,position:"inner",formatter:function(r){return`${r.name}(${r.value})`}},labelLine:{show:!1}}},data:Object.entries(a).map(([r,l])=>({name:r,value:l})).sort((r,l)=>l.value-r.value).slice(0,10)}]},notMerge:!0,lazyUpdate:!0,className:"!h-full"})]})})},Qn=R("/ins/$insID/_layout/index/$indexUID/_layout/")({component:Hn,pendingComponent:J}),Yn=({className:t})=>{const{t:s}=b("index"),n=C(),i=X(n),a=u.useRef(null),[r,l]=u.useState(!1),c=u.useCallback(()=>{l(!0)},[]),[m,g]=u.useState({}),[v,x]=u.useState(m),y=u.useCallback((j={})=>{var _;l(!1),g(j),r||(x(j),(_=a.current)==null||_.setValue(JSON.stringify(j,null,2)))},[r]),p=M({queryKey:["settings",n.config.host,i.index.uid],queryFn:async()=>(Q(),await i.index.getSettings())});u.useEffect(()=>{p.isSuccess&&!r&&y(p.data),p.isFetching||Y()},[r,p.data,p.isFetching,p.isSuccess,y]);const f=u.useCallback(j=>j&&x(JSON.parse(j)),[x]),h=ne({mutationFn:async j=>(Q(),await i.index.updateSettings(j)),onSuccess:j=>{V(j),setTimeout(()=>p.refetch(),450)},onSettled:()=>{Y()}}),o=u.useCallback(()=>{l(!1),v&&h.mutate(v)},[v,h]),d=u.useMemo(()=>p.isLoading||p.isFetching||h.isPending,[p.isFetching,p.isLoading,h.isPending]);return u.useMemo(()=>e.jsxs("div",{className:S(t,"p-1"),children:[e.jsxs("div",{className:"flex items-center gap-4 w-full pb-2",children:[e.jsxs("div",{className:"text-xl font-medium mr-auto flex items-center gap-2",children:[e.jsxs("p",{children:["JSON ",s("setting.index.config.label")]}),e.jsx("a",{href:"https://www.meilisearch.com/docs/reference/api/settings",target:"_blank",rel:"noreferrer",children:e.jsx("div",{className:"i-lucide:circle-help w-1em h-1em text-neutral-400"})})]}),!r&&e.jsx(w,{variant:"flat",size:"sm",color:"primary",onClick:()=>{c()},isLoading:d,children:s("edit")}),r&&e.jsx(w,{variant:"flat",size:"sm",color:"success",onClick:()=>{o()},isLoading:d,children:s("save")}),r&&e.jsx(w,{variant:"flat",size:"sm",color:"default",onClick:()=>{y()},children:s("cancel")})]}),e.jsx(Je,{language:"json",className:S("h-[30rem]",!r&&"opacity-50"),defaultValue:JSON.stringify(m,null,2),options:{automaticLayout:!0,lineDecorationsWidth:1,readOnly:!r},onChange:f,onMount:j=>{a.current=j}})]}),[t,s,r,d,m,f,c,o,y])},Gn=({afterMutation:t})=>{const{t:s}=b("index"),n=de(),i=D(),a=C(),r=X(a),l=ne({mutationFn:async()=>(Q(),await r.index.delete()),onSuccess:m=>{V(m),t(),n({to:`/ins/${i.id}`})},onSettled:()=>{Y()}}),c=ne({mutationFn:async()=>(Q(),await r.index.deleteAllDocuments()),onSuccess:m=>{V(m),t()},onSettled:()=>{Y()}});return u.useMemo(()=>e.jsxs("div",{className:"bg-rose-200 p-3 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-rose-900 text-lg font-bold",children:s("setting.index.danger_zone")}),e.jsx("div",{className:"flex flex-col items-start gap-4",children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(w,{variant:"solid",color:"danger",size:"sm",onClick:()=>{$.confirm({title:s("index_delete.dialog.title"),centered:!0,content:e.jsx("span",{dangerouslySetInnerHTML:{__html:s("index_delete.dialog.content",{uid:r.index.uid})}}),onOk:async()=>l.mutate(),okText:s("confirm"),cancelText:s("cancel")})},children:s("all_documents_delete.label")}),e.jsx(w,{variant:"solid",color:"danger",size:"sm",onClick:()=>$.confirm({title:s("all_documents_delete.dialog.title"),centered:!0,content:e.jsx("span",{dangerouslySetInnerHTML:{__html:s("all_documents_delete.dialog.content",{uid:r.index.uid})}}),onOk:async()=>c.mutate(),okText:s("confirm"),cancelText:s("cancel")}),children:s("index_delete.label")})]})})]}),[s,r.index.uid,l,c])},Xn=()=>e.jsx("div",{className:"grid grid-cols-6 h-full overflow-scroll",children:e.jsx("main",{className:"p-4 laptop:col-start-2 laptop:-col-end-2 col-start-1 -col-end-1 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col gap-4 px-1",children:[e.jsx(Yn,{}),e.jsx(Gn,{afterMutation:()=>window.location.reload()})]})})}),Zn=R("/ins/$insID/_layout/index/$indexUID/_layout/setting")({component:Xn,pendingComponent:Ne}),ei=({doc:t,onClickDocumentDel:s,onClickDocumentUpdate:n})=>{const{t:i}=b("document");return e.jsxs("div",{className:"text-xs rounded-xl p-4 bg-primary-50 odd:bg-opacity-20 even:bg-opacity-10 group relative",children:[e.jsx(ut,{name:!1,displayDataTypes:!1,displayObjectSize:!1,src:t.content,collapsed:3,collapseStringsAfterLength:50}),e.jsxs("div",{className:"absolute right-0 bottom-0 opacity-95 invisible group-hover:visible p-2 flex items-center gap-2",children:[e.jsx(ie,{type:"secondary",size:"mini",status:"warning",onClick:()=>n(t),children:i("common:update")}),e.jsx(ie,{type:"secondary",size:"mini",status:"danger",onClick:()=>s(t),children:i("common:delete")})]})]})},bt=({attr:t,indexSettings:s})=>{var i,a,r;const{t:n}=b("index");return e.jsxs(e.Fragment,{children:[((i=s==null?void 0:s.filterableAttributes)==null?void 0:i.includes(t))&&e.jsx(oe,{content:n("index:setting.filterableAttributes"),children:e.jsx(F,{size:"small",color:"amber",children:"FL"})}),((a=s==null?void 0:s.searchableAttributes)==null?void 0:a.includes(t))&&e.jsx(oe,{content:n("index:setting.searchableAttributes"),children:e.jsx(F,{size:"small",color:"indigo",children:"SC"})}),((r=s==null?void 0:s.sortableAttributes)==null?void 0:r.includes(t))&&e.jsx(oe,{content:n("index:setting.sortableAttributes"),children:e.jsx(F,{size:"small",color:"cyan",children:"ST"})})]})},ti=({doc:t,onClickDocumentDel:s,onClickDocumentUpdate:n,indexSettings:i})=>{const{t:a}=b("document");return e.jsxs("div",{className:"rounded-xl px-3 py-5 bg-primary-50/20 border border-transparent hover:border-primary group relative overflow-hidden",children:[e.jsx(H,{align:"center",data:Object.entries(t.content).map(([r,l])=>({key:e.jsxs("div",{className:"flex justify-end items-center gap-1",children:[i&&e.jsx(bt,{attr:r,indexSettings:i}),e.jsx("p",{children:r})]}),value:e.jsx(It,{name:r,value:l})}))}),e.jsxs("div",{className:"absolute right-0 bottom-0 opacity-95 invisible group-hover:visible p-1.5 flex items-center gap-2",children:[e.jsx(ie,{type:"secondary",size:"mini",status:"warning",onClick:()=>n(t),children:a("common:update")}),e.jsx(ie,{type:"secondary",size:"mini",status:"danger",onClick:()=>s(t),children:a("common:delete")})]})]})},It=({name:t,value:s,dateParser:n=!0})=>{let i=I.toString(s).trim();return I.isObjectLike(s)&&(i=In(s)),e.jsx("div",{className:"cursor-pointer",onClick:()=>{$.info({title:t,centered:!0,content:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(De,{className:"overflow-scroll whitespace-pre-wrap text-balance break-words",children:i}),tt(i)&&e.jsx(Ye,{width:"100%",src:i})]})})},children:n&&/^.*(date|time).*$/gim.test(t)&&et(i)?ke(et(i)):tt(i)?e.jsx(Ye,{width:"100%",src:i,preview:!1}):I.truncate(i,{length:20})})},si=({docs:t=[],refetchDocs:s,type:n="json",currentIndex:i})=>{const{t:a}=b("document"),r=C(),[l,c]=u.useState(),m=D(),g=M({queryKey:["indexSettings",m.host,i.uid],queryFn:async()=>await i.getSettings()}),v=u.useMemo(()=>g.data,[g.data]),x=ne({mutationFn:async({indexId:o,docs:d})=>await r.index(o).updateDocuments(d),onSuccess:o=>{V(o),s()},onError:o=>{console.error(o),Me(o)}}),y=ne({mutationFn:async({indexId:o,docId:d})=>await r.index(o).deleteDocuments(d),onSuccess:o=>{V(o),s()},onError:o=>{console.error(o),Me(o)}}),p=u.useCallback(o=>{const d=o.primaryKey;console.debug("onClickDocumentDel","pk",d),d?$.confirm({title:a("delete_document"),centered:!0,content:e.jsx("p",{dangerouslySetInnerHTML:{__html:a("delete.tip",{indexId:o.indexId,primaryKey:o.content[d]})}}),okText:a("confirm"),cancelText:a("cancel"),onOk:()=>{y.mutate({indexId:o.indexId,docId:[o.content[d]]})}}):N.error(a("delete.require_primaryKey",{indexId:o.indexId}))},[y,a]),f=u.useCallback((o="[]")=>c(d=>({...d,content:JSON.parse(o)})),[]),h=u.useCallback(o=>{const d=o.primaryKey;console.debug("onClickDocumentUpdate","pk",d),d&&$.confirm({title:a("edit_document"),centered:!0,size:"large",content:e.jsx("div",{className:"border rounded-xl p-2",children:e.jsx(Je,{language:"json",className:"h-80",defaultValue:JSON.stringify((o==null?void 0:o.content)??{},null,2),options:{automaticLayout:!0,lineDecorationsWidth:1},onChange:f})}),okText:a("submit"),cancelText:a("cancel"),onOk:()=>{l&&x.mutate({indexId:l.indexId,docs:[l.content]})}})},[x,l,f,a]);return u.useMemo(()=>n==="table"?e.jsx("div",{children:e.jsx(Cs,{columns:[...new Set(t.reduce((o,d)=>o.concat(Object.keys(d.content)),[t[0].primaryKey]))].map(o=>({title:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{children:o}),v&&e.jsx(bt,{attr:o,indexSettings:v})]}),dataIndex:o,width:"15rem",ellipsis:!0,render(d,j){return e.jsx(It,{name:o,value:j[o],dateParser:!1})}})).concat([{title:a("common:actions"),fixed:"right",align:"center",width:"8rem",render:(o,d,j)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{type:"secondary",size:"mini",status:"warning",onClick:()=>h(t[j]),children:a("common:update")}),e.jsx(ie,{type:"secondary",size:"mini",status:"danger",onClick:()=>p(t[j]),children:a("common:delete")})]})}]),data:t.map(o=>({...o.content})),stripe:!0,hover:!0,virtualized:!0,pagination:!1,size:"small",scroll:{x:!0,y:!0}})}):n==="grid"?e.jsx("div",{className:"grid grid-cols-3 laptop:grid-cols-4 gap-3",children:t.map((o,d)=>e.jsx(ti,{doc:o,indexSettings:v,onClickDocumentDel:p,onClickDocumentUpdate:h},d))}):e.jsx(e.Fragment,{children:t.map((o,d)=>e.jsx(ei,{doc:o,onClickDocumentDel:p,onClickDocumentUpdate:h},d))}),[t,v,p,h,a,n])},ni=({searchForm:t,searchFormError:s,onFormSubmit:n,submitBtnText:i,indexIdEnable:a=!1,isFetching:r,onAutoRefreshChange:l})=>{const{t:c}=b("document");return u.useMemo(()=>e.jsxs("form",{className:"flex flex-col gap-2 ",onSubmit:n,children:[e.jsxs("div",{className:ct("prompt danger ghost xs",!s&&"hidden"),children:[e.jsx("div",{className:"icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-alert-triangle",width:18,height:18,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M10.24 3.957l-8.422 14.06a1.989 1.989 0 0 0 1.7 2.983h16.845a1.989 1.989 0 0 0 1.7 -2.983l-8.423 -14.06a1.989 1.989 0 0 0 -3.4 0z"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 17h.01"})]})}),e.jsx("div",{className:"content",children:e.jsx("p",{children:s})})]}),a&&e.jsx(ve,{leftSection:e.jsx(Ot,{size:16}),radius:"md",placeholder:c("search.form.indexId.placeholder"),required:!0,...t.getInputProps("indexId")}),e.jsx(ve,{leftSection:e.jsx(Mt,{size:16}),autoFocus:!0,radius:"md",placeholder:c("search.form.q.placeholder"),...t.getInputProps("q")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ve,{className:"flex-1",label:c("search.form.filter.label"),leftSection:e.jsx(qt,{size:16}),radius:"md",...t.getInputProps("filter")}),e.jsx(A,{content:c("search.form.sort.tip"),children:e.jsx(ve,{className:"flex-1",label:c("search.form.sort.label"),leftSection:e.jsx(Kt,{size:16}),radius:"md",...t.getInputProps("sort")})})]}),e.jsxs("div",{className:"flex items-stretch gap-4",children:[e.jsx(Ge,{radius:"md",label:c("search.form.limit.label"),...t.getInputProps("limit")}),e.jsx(Ge,{radius:"md",label:c("search.form.offset.label"),...t.getInputProps("offset")}),e.jsxs("div",{className:"ml-auto mt-auto flex gap-x-4 items-center",children:[e.jsx(A,{position:"bottom",content:c("search.form.autoRefresh.tip"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",defaultChecked:!1,children:c("search.form.autoRefresh.label")}),e.jsx(Gt,{loading:r,onChange:m=>l(m)})]})}),e.jsx(w,{type:"submit",size:"sm",color:"primary",children:i})]})]})]}),[n,s,a,c,t,r,i,l])},ii=({data:t,fileName:s,fileType:n})=>{const i=new Blob([t],{type:n}),a=document.createElement("a");a.download=s,a.href=window.URL.createObjectURL(i);const r=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});a.dispatchEvent(r),a.remove()},ai=(t,s)=>{ii({data:JSON.stringify(t),fileName:`${s}.json`,fileType:"text/json"})},Ie={hits:[],estimatedTotalHits:0,processingTimeMs:0},ri=T.object({q:T.string().optional().default(""),limit:T.number().positive().optional().default(20),offset:T.number().nonnegative().optional().default(0),filter:T.string().optional().default(""),sort:T.string().optional().default("")}),oi=()=>{var _,L,He;const t=de({from:Ke.fullPath}),s=Ke.useSearch(),{t:n}=b("document"),[i,a]=u.useState("json"),[r,l]=u.useState(!1),[c,m]=u.useState(null),g=C(),v=X(g),x=D(),y=x==null?void 0:x.host,p=u.useMemo(()=>v?g.index(v.index.uid):void 0,[g,v]),f=we({initialValues:{...s},validate:{limit:q=>q<500?null:n("search.form.limit.validation_error")}});u.useEffect(()=>{t({search:()=>({...f.values})})},[t,f.values]);const h=M({queryKey:["indexPrimaryKey",y,p==null?void 0:p.uid],queryFn:async()=>{var q;return(q=await(p==null?void 0:p.getRawInfo()))==null?void 0:q.primaryKey},enabled:!!v}),o=$s(f.values,{wait:450}),d=M({queryKey:["searchDocuments",y,p==null?void 0:p.uid],refetchInterval:r?7e3:!1,refetchOnMount:r,refetchOnWindowFocus:r,refetchOnReconnect:r,queryFn:async()=>{const{q,limit:he,offset:fe,filter:ge,sort:ae=""}={...f.values,...o};if(f.validate().hasErrors)return Ie;const z=ae.match(/(([\w\.]+)|(_geoPoint\([\d\.,\s]+\))){1}\:((asc)|(desc))/g)||[];console.debug("search sorting expression",ae,z);try{const Ce=await p.search(q,{limit:he,offset:fe,filter:ge,sort:z.map(W=>W.trim())});return m(null),Ce||Ie}catch(Ce){const W=Ce.message;return m(null),W.match(/filter/i)?f.setFieldError("filter",W):W.match(/sort/i)?f.setFieldError("sort",W):m(W),Ie}},enabled:!!v}),j=u.useCallback(async()=>{await d.refetch()},[d]);return u.useEffect(()=>{r&&d.refetch()},[o]),u.useMemo(()=>{var q,he,fe,ge,ae;return e.jsxs("div",{className:"h-full flex flex-col p-4 gap-4 overflow-hidden",children:[e.jsx("div",{className:`rounded-lg ${d.isFetching?"rainbow-ring-rotate":""}`,children:e.jsx("div",{className:"rounded-lg p-4 border",children:e.jsx(ni,{onAutoRefreshChange:z=>l(z),isFetching:d.isFetching,searchForm:f,searchFormError:c,onFormSubmit:f.onSubmit(j),submitBtnText:n("common:search")})})}),e.jsx("div",{className:"h-px w-full bg-neutral-200 scale-x-150"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("p",{className:"font-extrabold text-2xl",children:n("search.results.label")}),e.jsxs(Xt,{type:"button",buttonSize:"middle",defaultValue:i,onChange:z=>a(z.target.value),children:[e.jsx(Se,{value:"json",children:"JSON"}),e.jsx(Se,{value:"table",children:n("search.results.type.table")}),e.jsx(Se,{value:"grid",children:n("search.results.type.grid")})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3 px-4 font-light text-xs text-neutral-500",children:[e.jsxs(ce,{type:"secondary",size:"small",onClick:()=>{var z;return ai(((z=d.data)==null?void 0:z.hits)||Ie.hits,"search-results")},children:[n("search.results.download")," ",`(${((q=d.data)==null?void 0:q.hits.length)||0})`]}),e.jsx("p",{children:n("search.results.total_hits",{estimatedTotalHits:(he=d.data)==null?void 0:he.estimatedTotalHits})}),e.jsx("p",{children:n("search.results.processing_time",{processingTimeMs:(fe=d.data)==null?void 0:fe.processingTimeMs})})]})]}),e.jsx("div",{className:"flex flex-col gap-4 overflow-scroll",children:d.isFetching?e.jsx("div",{className:"flex-1 flex justify-center items-center",children:e.jsx(Ne,{})}):(((ge=d.data)==null?void 0:ge.hits.length)||0)>0?e.jsx(si,{currentIndex:v.index,type:i,docs:(ae=d.data)==null?void 0:ae.hits.map(z=>({indexId:v.index.uid,content:z,primaryKey:h.data})),refetchDocs:d.refetch}):e.jsx("div",{className:"scale-75",children:e.jsx(yt,{})})})]})},[d.isFetching,(_=d.data)==null?void 0:_.estimatedTotalHits,(L=d.data)==null?void 0:L.processingTimeMs,(He=d.data)==null?void 0:He.hits,d.refetch,f,c,j,n,i,v,h.data])},Ke=R("/ins/$insID/_layout/index/$indexUID/_layout/documents/")({component:oi,pendingComponent:J,validateSearch:ri}),li=()=>{const{t}=b("upload"),[s,n]=u.useState("leave"),i=u.useRef(null),a=D(),r=C(),l=X(r),c=a==null?void 0:a.host,m=a==null?void 0:a.apiKey,g=we({initialValues:{documents:[]},validate:{documents:o=>{if(o instanceof File?o.size>0:o.length>0)return null;{const d=t("documents_json_array_requirement");return N.error(d),d}}}}),v=ne({mutationFn:async o=>{const d=new URL(`/indexes/${l.index.uid}/documents`,c),_=await(await fetch(d,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:m?`Bearer ${m}`:""},body:o instanceof File?o:JSON.stringify(o)})).json();return console.debug("addDocumentsMutation","response",_),_},onSuccess:o=>{V(o),g.reset()},onError:o=>{console.error(o),Me(o)},onMutate(){s!=="uploading"&&(n("uploading"),Q())},onSettled(){s==="uploading"&&n("leave"),Y()}}),x=u.useCallback(async()=>{const[o]=await navigator.clipboard.read();if(o.types.includes("text/plain")){const d=JSON.parse(await(await o.getType("text/plain")).text()),j=I.isArray(d)?d:I.isObject(d)?[d]:[];console.debug("onAddDocumentsByEditorClick paste clipboard",j,d),j.length>0&&i&&(i.current.setValue(JSON.stringify(j,null,2)),N.success(t("clipboard_json_pasted")))}},[t]),y=u.useCallback(async o=>{await v.mutate(o.documents)},[g,v]),p=u.useCallback(async()=>{if(s==="uploading")return;const o=document.getElementById("documents-json-file-selector");o&&(o.click(),await o.addEventListener("change",async d=>{const j=d.target.files[0];console.debug("onImportAreaClick","file-change",j),await y({documents:j})},!1))},[s,y]),f=u.useCallback(async o=>{if(o.preventDefault(),s==="uploading")return;const d=o.dataTransfer.files[0];console.debug("onImportAreaDrop","drop",d),await y({documents:d})},[s,y]),h=u.useCallback((o="[]")=>g.setFieldValue("documents",JSON.parse(o)),[g]);return u.useMemo(()=>e.jsx("div",{className:`overflow-hidden fill 
        flex flex-col items-stretch rounded-3xl gap-4`,children:e.jsxs("div",{className:"flex-1 flex gap-4 p-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t("input_by_editor")}),e.jsx(F,{size:"small",children:t("manually_type_in")}),e.jsx(oe,{content:t("click_to_paste_clipboard_content_if_it_is_valid_json"),position:"bottom",children:e.jsx(Ue,{className:"cursor-pointer",size:"1em",onClick:()=>x()})})]}),e.jsxs("form",{className:"flex-1 flex flex-col gap-y-4 overflow-hidden",onSubmit:g.onSubmit(y),children:[e.jsx("div",{className:"border rounded-xl p-2 overflow-scroll",children:e.jsx(Je,{language:"json",className:"h-[32rem]",defaultValue:JSON.stringify(g.values.documents,null,2),options:{automaticLayout:!0,lineDecorationsWidth:1},onChange:h,onMount:o=>{console.debug("editorDidMount",o,o.getValue(),o.getModel()),i.current=o}})}),e.jsx(w,{type:"submit",color:"success",children:t("submit")})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"only-one-line flex items-center",children:[e.jsx("span",{className:"pr-2",children:t("import_json_file")}),e.jsx(F,{size:"small",children:t("for_large_documents")})]}),e.jsxs("div",{className:S("flex-1 flex flex-col justify-center items-center gap-4","rounded-2xl !border-4 border-dashed  border-neutral-500","transition-colors duration-500","drag-json-file-area",s!=="uploading"?"cursor-pointer":"cursor-not-allowed",{"border-green-600":s==="over","border-rose-600":s==="uploading"}),onClick:()=>p(),onDrop:f,onDragOver:o=>{o.preventDefault(),n("over")},onDragLeave:o=>{o.preventDefault(),n("leave")},children:[e.jsx("h6",{className:"text-2xl",children:s==="over"?e.jsx(e.Fragment,{children:t("release_to_upload_documents")}):s==="uploading"?e.jsxs(e.Fragment,{children:[t("uploading"),"..."]}):e.jsx("span",{dangerouslySetInnerHTML:{__html:t("drag_and_drop_a_file_here",{type:'<strong class="underline">JSON</strong>'})}})}),e.jsx("span",{children:t("or")}),e.jsx(w,{variant:"bordered",color:s==="over"?"success":s==="uploading"?"danger":"default",disabled:s==="uploading",children:t("browse_file")}),e.jsx("input",{type:"file",id:"documents-json-file-selector",accept:".json",className:"hidden",multiple:!1,min:1,max:1})]})]})]})}),[g,s,h,y,p,f,x,t])},ci=R("/ins/$insID/_layout/index/$indexUID/_layout/documents/upload")({component:li,pendingComponent:J}),di=R("/ins/$insID")(),ui=R("/ins/$insID/_layout/index/$indexUID")(),mi=gn.update({path:"/warning",getParentRoute:()=>_e}),xi=_n.update({path:"/",getParentRoute:()=>_e}),wt=di.update({path:"/ins/$insID",getParentRoute:()=>_e}),xe=Tn.update({id:"/_layout",getParentRoute:()=>wt}),pi=Fn.update({path:"/",getParentRoute:()=>xe}),hi=qe.update({path:"/tasks",getParentRoute:()=>xe}),fi=Vn.update({path:"/keys",getParentRoute:()=>xe}),_t=ui.update({path:"/index/$indexUID",getParentRoute:()=>xe}),pe=Wn.update({id:"/_layout",getParentRoute:()=>_t}),gi=Qn.update({path:"/",getParentRoute:()=>pe}),ji=Zn.update({path:"/setting",getParentRoute:()=>pe}),yi=Ke.update({path:"/documents/",getParentRoute:()=>pe}),vi=ci.update({path:"/documents/upload",getParentRoute:()=>pe}),bi={InsInsIDLayoutIndexIndexUIDLayoutSettingRoute:ji,InsInsIDLayoutIndexIndexUIDLayoutIndexRoute:gi,InsInsIDLayoutIndexIndexUIDLayoutDocumentsUploadRoute:vi,InsInsIDLayoutIndexIndexUIDLayoutDocumentsIndexRoute:yi},Ii=pe._addFileChildren(bi),wi={InsInsIDLayoutIndexIndexUIDLayoutRoute:Ii},_i=_t._addFileChildren(wi),ki={InsInsIDLayoutKeysRoute:fi,InsInsIDLayoutTasksRoute:hi,InsInsIDLayoutIndexRoute:pi,InsInsIDLayoutIndexIndexUIDRoute:_i},Ni=xe._addFileChildren(ki),Di={InsInsIDLayoutRoute:Ni},Ci=wt._addFileChildren(Di),Si={IndexRoute:xi,WarningRoute:mi,InsInsIDRoute:Ci},Ri=_e._addFileChildren(Si)._addFileTypes();function Ti(){const{history:t}=Be(),{t:s}=b();return e.jsxs("div",{className:"full-page bg-mount gap-y-10 justify-center items-center",children:[e.jsx(me,{}),e.jsx("h1",{className:"text-primary-100 font-bold",children:"404 Page Not Found"}),e.jsx("div",{className:"",children:e.jsx(ze,{variant:"gradient",color:"blue",onClick:()=>t.back(),children:s("back")})}),e.jsx(ue,{})]})}const kt=new hs({defaultOptions:{queries:{throwOnError:!0,refetchIntervalInBackground:!1,refetchOnReconnect:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",refetchInterval:3e4}}}),$i=fs({routeTree:Ri,basepath:"/meiliAdmin/riccox",context:{queryClient:kt},defaultPreload:"intent",defaultPendingComponent:()=>e.jsx("div",{className:"h-dvh flex justify-center items-center",children:e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx(me,{className:"shrink"}),e.jsx("div",{className:"my-2 min-h-10 w-0.5 bg-neutral-300"}),e.jsx(Ne,{})]})}),defaultPreloadStaleTime:0,defaultNotFoundComponent:Ti}),it=document.getElementById("root");it.innerHTML||Dt.createRoot(it).render(e.jsx(Nt.StrictMode,{children:e.jsxs(gs,{client:kt,children:[e.jsx(Vs,{children:e.jsx(js,{router:$i})}),e.jsx(ys,{initialIsOpen:!1})]})}));
